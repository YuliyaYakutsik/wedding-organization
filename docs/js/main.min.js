"use strict";$(document).ready(function(){$.modules.main.init()}),function(){if(!("modules"in $&&"advantages"in $.modules)){var e=function(){var e=this;e.setupListener=function(){$(window).on("resize",e.animateAdvantages)},e.equalHeight=function(){var e=$(".advantages__item__title");e.matchHeight()},e.animateAdvantages=function(){var e=$(".advantages__list");$(window).width()<="640"?e.hasClass("owl-carousel")||(e.addClass("owl-carousel").addClass(".owl-theme"),e.on("initialized.owl.carousel",function(){var e=$(".advantages__item");e.matchHeight()}),e.owlCarousel({loop:!0,items:1,smartSpeed:300,mouseDrag:!1})):e.hasClass("owl-carousel")&&(e.removeClass("owl-carousel").removeClass(".owl-theme"),e.trigger("destroy.owl.carousel"))},e.init=function(){e.equalHeight(),e.animateAdvantages(),e.setupListener()}};"modules"in $||($.modules={}),$.modules.advantages=new e}}(),function(){if(!("modules"in $&&"header"in $.modules)){var e=function(){var e=this;e.setupListener=function(){$(window).on("resize",e.showHeaderMenu),$(".header__preview__link").on("click",e.goToTop),$(".header__burger-menu__link").on("click",e.burgerMenu)},e.showHeaderMenu=function(){var e=$(".header__menu");$(window).width()>="1024"&&e.hasClass("header__menu_burger_active")&&(e.removeClass("header__menu_burger_active"),$(".header__burger-menu__link").removeClass("header__burger-menu__link_active"))},e.goToTop=function(e){e.preventDefault(),$("body, html").animate({scrollTop:0},600)},e.burgerMenu=function(e){e.preventDefault(),$(this).hasClass("header__burger-menu__link_active")?($(this).removeClass("header__burger-menu__link_active"),$(".header__menu").removeClass("header__menu_burger_active"),$("html").removeClass("fixed")):($(this).addClass("header__burger-menu__link_active"),$(".header__menu").addClass("header__menu_burger_active"),$("html").addClass("fixed"))},e.init=function(){e.setupListener()}};"modules"in $||($.modules={}),$.modules.header=new e}}(),function(){if(!("modules"in $&&"main"in $.modules)){var e=function(){var e=this;e.window=$(window),e.html=$("html"),e.body=$("body"),e.modules=$.modules,e.initModules=function(){for(var i in e.modules)e.modules.hasOwnProperty(i)&&"undefined"!=typeof e.modules[i].init&&"main"!==i&&e.modules[i].init()},e.init=function(){e.initModules()}};"modules"in $||($.modules={}),$.modules.main=new e}}(),function(){if(!("modules"in $&&"menu"in $.modules)){var e=function(){var e=this;e.setupListener=function(){window.location.hash&&e.showSection(window.location.hash,!1),$(window).on("scroll",e.checkSection),$(".menu__link").on("click",function(i){i.preventDefault(),$(".header__menu").hasClass("header__menu_burger_active")?e.showSection($(this).attr("href"),!1):e.showSection($(this).attr("href"),!0),$("html").removeClass("fixed"),$(".header__burger-menu__link").removeClass("header__burger-menu__link_active"),$(".header__menu").removeClass("header__menu_burger_active")})},e.checkSection=function(){$("section").each(function(){var e=$(this);if(e.data("section")){var i=e.offset().top-250,n=i+e.height(),a=$(window).scrollTop();if(i<a&&n>a){var t=e.data("section"),o=$(".menu__link").filter('[href="#'+t+'"]');if(o.closest(".menu__item").addClass("menu__item_active").siblings().removeClass("menu__item_active"),window.location.hash=t,"main"===e.data("section")){var s=$(".menu__item");s.removeClass("menu__item_active")}}}})},e.showSection=function(e,i){var n=e.replace(/#/,""),a=$("section").filter('[data-section="'+n+'"]'),t=a.offset().top-$(".header").height();i?$("body, html").animate({scrollTop:t},600):$("body, html").scrollTop(t)},e.init=function(){e.setupListener()}};"modules"in $||($.modules={}),$.modules.menu=new e}}(),function(){if(!("modules"in $&&"map"in $.modules)){var e=function(){var e=this;e.insertMap=function(){for(var e=[{featureType:"water",stylers:[{color:"#1869da"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{saturation:"-70"}]},{featureType:"landscape.natural",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"all",stylers:[{color:"#EEEEEE"}]},{featureType:"road",elementType:"all",stylers:[{lightness:"-5"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]}],i=new google.maps.Map(document.getElementById("map"),{center:{lat:53.929847,lng:27.57642},styles:e,disableDefaultUI:!0,zoom:13,backgroundColor:"rgba(24,105,218,.04)"}),n=$(".map").data("markers"),a={url:"images/vis-pin-map.png"},t=[],o=[],s=function(e){var s=new google.maps.Marker({position:{lat:n[e].lat,lng:n[e].lng},map:i,animation:google.maps.Animation.DROP,icon:a}),l='<div class="map-info__title">'+n[e].title+"</div>",r='<div class="map-info__text">'+n[e].address+"</div>",u=l+r,d=new google.maps.InfoWindow({content:u});t.push(s),o.push(d),s.addListener("click",function(){for(var e=0;e<t.length;e++)o[e].close(i,t[e]);d.open(i,s)})},l=0;l<n.length;l++)s(l)},e.init=function(){e.insertMap()}};"modules"in $||($.modules={}),$.modules.map=new e}}(),function(){if(!("modules"in $&&"owl"in $.modules)){var e=function(){var e=this;e.countItems=function(e,i){var n=" "+e.length;i.data("items",e.length),i.text(n)}};"modules"in $||($.modules={}),$.modules.owl=new e}}(),function(){if(!("modules"in $&&"reviews"in $.modules)){var e=function(){var e=this;e.openFullReview=function(){$(".review__href").fancybox({type:"inline",maxWidth:460,padding:0,closeBtn:!1})},e.init=function(){e.openFullReview()}};"modules"in $||($.modules={}),$.modules.reviews=new e}}(),function(){if(!("modules"in $&&"steps"in $.modules)){var e=function(){var e=this;e.setupListener=function(){$(window).on("resize",e.animateSteps)},e.equalHight=function(){var e=$(".steps__item");e.matchHeight()},e.animateSteps=function(){var e=$(".steps__list"),i=e.next(".owl-navigation"),n=i.find(".owl-navigation__all-pages");$(window).width()<="1023"?e.hasClass("owl-carousel")?n.text($(".steps__list").next(".owl-navigation").find(".owl-navigation__all-pages").data("items")-(Math.floor(e.width()/$(".steps__item").innerWidth())-1)):(e.addClass("owl-carousel").addClass(".owl-theme"),e.on("initialized.owl.carousel",function(a){var t=$(".steps__item"),o=i.find(".owl-navigation__active-page");t.addClass("steps__item_carousel"),t.matchHeight(),o.text("1 "),i.addClass("owl-navigation_active"),i.find(".owl-navigation__link_prev").addClass("disabled"),n.text(a.item.count-(Math.floor(e.width()/t.innerWidth())-1))}),e.owlCarousel({loop:!1,items:1,autoWidth:!0,slideBy:1,smartSpeed:300,mouseDrag:!1,info:!0,responsive:{641:{items:4,autoWidth:!0,margin:0,slideBy:1}}}),e.on("changed.owl.carousel",function(){var n=e.find(".owl-dot.active").index(),a=n+1+" ",t=i.find(".owl-navigation__active-page");t.text(a),0===n?i.find(".owl-navigation__link_prev").addClass("disabled"):i.find(".owl-navigation__link_prev").removeClass("disabled"),(n+1).toString()===i.find(".owl-navigation__all-pages").text().replace(" ","")?i.find(".owl-navigation__link_next").addClass("disabled"):i.find(".owl-navigation__link_next").removeClass("disabled")}),i.find(".owl-navigation__link").on("click",function(i){i.preventDefault();var n=$(this);n.hasClass("owl-navigation__link_prev")?e.trigger("prev.owl.carousel"):e.trigger("next.owl.carousel")})):e.hasClass("owl-carousel")&&(e.off("changed.owl.carousel"),e.removeClass("owl-carousel").removeClass(".owl-theme"),i.find(".owl-navigation__link").off(),e.next(".owl-navigation").removeClass("owl-navigation_active"),e.trigger("destroy.owl.carousel"),$(".steps__item").removeClass("steps__item_carousel"))},e.init=function(){e.equalHight(),$.modules.owl.countItems($(".steps__item"),$(".steps__list").next(".owl-navigation").find(".owl-navigation__all-pages")),e.animateSteps(),e.setupListener()}};"modules"in $||($.modules={}),$.modules.steps=new e}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4ubWluLmpzIiwibWFpbi5qcyIsImFkdmFudGFnZXMvYWR2YW50YWdlcy5qcyIsImhlYWRlci9oZWFkZXIuanMiLCJtYWluL21haW4uanMiLCJtZW51L21lbnUuanMiLCJtYXAvbWFwLmpzIiwib3dsQ2Fyb3VzZWwvb3dsQ2Fyb3VzZWwuanMiLCJyZXZpZXdzL3Jldmlld3MuanMiLCJzdGVwcy9zdGVwcy5qcyJdLCJuYW1lcyI6WyIkIiwiZG9jdW1lbnQiLCJyZWFkeSIsIm1vZHVsZXMiLCJtYWluIiwiaW5pdCIsIkFkdmFudGFnZXMiLCJzZWxmIiwidGhpcyIsInNldHVwTGlzdGVuZXIiLCJ3aW5kb3ciLCJvbiIsImFuaW1hdGVBZHZhbnRhZ2VzIiwiZXF1YWxIZWlnaHQiLCJpdGVtIiwibWF0Y2hIZWlnaHQiLCJvd2wiLCJ3aWR0aCIsImhhc0NsYXNzIiwiYWRkQ2xhc3MiLCJvd2xDYXJvdXNlbCIsImxvb3AiLCJpdGVtcyIsInNtYXJ0U3BlZWQiLCJtb3VzZURyYWciLCJyZW1vdmVDbGFzcyIsInRyaWdnZXIiLCJhZHZhbnRhZ2VzIiwiSGVhZGVyIiwic2hvd0hlYWRlck1lbnUiLCJnb1RvVG9wIiwiYnVyZ2VyTWVudSIsImhlYWRlck1lbnUiLCJlIiwicHJldmVudERlZmF1bHQiLCJhbmltYXRlIiwic2Nyb2xsVG9wIiwiaGVhZGVyIiwiTWFpbiIsImh0bWwiLCJib2R5IiwiaW5pdE1vZHVsZXMiLCJtb2R1bGUiLCJoYXNPd25Qcm9wZXJ0eSIsIk1lbnUiLCJsb2NhdGlvbiIsImhhc2giLCJzaG93U2VjdGlvbiIsImNoZWNrU2VjdGlvbiIsImF0dHIiLCJlYWNoIiwiJHRoaXMiLCJkYXRhIiwidG9wRWRnZSIsIm9mZnNldCIsInRvcCIsImJvdHRvbUVkZ2UiLCJoZWlnaHQiLCJ3U2Nyb2xsIiwiY3VycmVudElkIiwicmVxTGluayIsImZpbHRlciIsImNsb3Nlc3QiLCJzaWJsaW5ncyIsInNlY3Rpb24iLCJpc0FuaW1hdGUiLCJkaXJlY3Rpb24iLCJyZXBsYWNlIiwicmVxU2VjdGlvbiIsInJlcVNlY3Rpb25Qb3MiLCJtZW51IiwiTWFwIiwiaW5zZXJ0TWFwIiwic3R5bGVBcnJheSIsImZlYXR1cmVUeXBlIiwic3R5bGVycyIsImNvbG9yIiwiZWxlbWVudFR5cGUiLCJzYXR1cmF0aW9uIiwidmlzaWJpbGl0eSIsImxpZ2h0bmVzcyIsIm1hcCIsImdvb2dsZSIsIm1hcHMiLCJnZXRFbGVtZW50QnlJZCIsImNlbnRlciIsImxhdCIsImxuZyIsInN0eWxlcyIsImRpc2FibGVEZWZhdWx0VUkiLCJ6b29tIiwiYmFja2dyb3VuZENvbG9yIiwibWFya2VycyIsImltYWdlIiwidXJsIiwibWFya2Vyc0FycmF5IiwiaW5mb1dpbmRvd0FycmF5IiwiX2xvb3AiLCJpIiwibWFya2VyIiwiTWFya2VyIiwicG9zaXRpb24iLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwiaWNvbiIsInRpdGxlIiwiYWRkcmVzcyIsImNvbnRlbnRTdHJpbmciLCJpbmZvV2luZG93IiwiSW5mb1dpbmRvdyIsImNvbnRlbnQiLCJwdXNoIiwiYWRkTGlzdGVuZXIiLCJsZW5ndGgiLCJjbG9zZSIsIm9wZW4iLCJPd2wiLCJjb3VudEl0ZW1zIiwiY29udGFpbmVyIiwibmV3VGV4dCIsInRleHQiLCJSZXZpZXdzIiwib3BlbkZ1bGxSZXZpZXciLCJmYW5jeWJveCIsInR5cGUiLCJtYXhXaWR0aCIsInBhZGRpbmciLCJjbG9zZUJ0biIsInJldmlld3MiLCJTdGVwcyIsImFuaW1hdGVTdGVwcyIsImVxdWFsSGlnaHQiLCJuYXYiLCJuZXh0IiwiYWxsUGFnZXMiLCJmaW5kIiwiTWF0aCIsImZsb29yIiwiaW5uZXJXaWR0aCIsImFjdGl2ZUl0ZW0iLCJjb3VudCIsImF1dG9XaWR0aCIsInNsaWRlQnkiLCJpbmZvIiwicmVzcG9uc2l2ZSIsIjY0MSIsIm1hcmdpbiIsImluZGV4IiwidG9TdHJpbmciLCJvZmYiLCJzdGVwcyJdLCJtYXBwaW5ncyI6IkFBQUEsWUNHQUEsR0FBQUMsVUFB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IjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbi8qKlxyXG4gKiBJbml0IG1haW4gbW9kdWxlXHJcbiAqL1xuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICQubW9kdWxlcy5tYWluLmluaXQoKTtcbn0pO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gJCAmJiAnYWR2YW50YWdlcycgaW4gJC5tb2R1bGVzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IEFkdmFudGFnZXMgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIEFkdmFudGFnZXMgPSBmdW5jdGlvbiBBZHZhbnRhZ2VzKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZCBldmVudHMgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZScsIHNlbGYuYW5pbWF0ZUFkdmFudGFnZXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFcXVhbEhlaWdodCBvZiB0aGUgaXRlbS10aXRsZXNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZXF1YWxIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9ICQoJy5hZHZhbnRhZ2VzX19pdGVtX190aXRsZScpO1xuXG4gICAgICAgICAgICBpdGVtLm1hdGNoSGVpZ2h0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFuaW1hdGUgTmV0d29yay1UYWJsZXRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuYW5pbWF0ZUFkdmFudGFnZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgb3dsID0gJCgnLmFkdmFudGFnZXNfX2xpc3QnKTtcblxuICAgICAgICAgICAgaWYgKCQod2luZG93KS53aWR0aCgpIDw9ICc2NDAnKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFvd2wuaGFzQ2xhc3MoJ293bC1jYXJvdXNlbCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIG93bC5hZGRDbGFzcygnb3dsLWNhcm91c2VsJykuYWRkQ2xhc3MoJy5vd2wtdGhlbWUnKTtcbiAgICAgICAgICAgICAgICAgICAgb3dsLm9uKCdpbml0aWFsaXplZC5vd2wuY2Fyb3VzZWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9ICQoJy5hZHZhbnRhZ2VzX19pdGVtJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ubWF0Y2hIZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgb3dsLm93bENhcm91c2VsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3A6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNtYXJ0U3BlZWQ6IDMwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlRHJhZzogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAob3dsLmhhc0NsYXNzKCdvd2wtY2Fyb3VzZWwnKSkge1xuICAgICAgICAgICAgICAgICAgICBvd2wucmVtb3ZlQ2xhc3MoJ293bC1jYXJvdXNlbCcpLnJlbW92ZUNsYXNzKCcub3dsLXRoZW1lJyk7XG4gICAgICAgICAgICAgICAgICAgIG93bC50cmlnZ2VyKCdkZXN0cm95Lm93bC5jYXJvdXNlbCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYuZXF1YWxIZWlnaHQoKTtcbiAgICAgICAgICAgIHNlbGYuYW5pbWF0ZUFkdmFudGFnZXMoKTtcbiAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gJCkpIHtcbiAgICAgICAgJC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgJC5tb2R1bGVzLmFkdmFudGFnZXMgPSBuZXcgQWR2YW50YWdlcygpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluICQgJiYgJ2hlYWRlcicgaW4gJC5tb2R1bGVzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgSGVhZGVyIGNsYXNzLlxyXG4gICAgICogQGNsYXNzXHJcbiAgICAgKi9cbiAgICB2YXIgSGVhZGVyID0gZnVuY3Rpb24gSGVhZGVyKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQWRkIGV2ZW50cyBsaXN0ZW5lcnNcclxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdyZXNpemUnLCBzZWxmLnNob3dIZWFkZXJNZW51KTtcbiAgICAgICAgICAgICQoJy5oZWFkZXJfX3ByZXZpZXdfX2xpbmsnKS5vbignY2xpY2snLCBzZWxmLmdvVG9Ub3ApO1xuICAgICAgICAgICAgJCgnLmhlYWRlcl9fYnVyZ2VyLW1lbnVfX2xpbmsnKS5vbignY2xpY2snLCBzZWxmLmJ1cmdlck1lbnUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNob3dzIEhlYWRlck1lbnVcclxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zaG93SGVhZGVyTWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBoZWFkZXJNZW51ID0gJCgnLmhlYWRlcl9fbWVudScpO1xuXG4gICAgICAgICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPj0gJzEwMjQnICYmIGhlYWRlck1lbnUuaGFzQ2xhc3MoJ2hlYWRlcl9fbWVudV9idXJnZXJfYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJNZW51LnJlbW92ZUNsYXNzKCdoZWFkZXJfX21lbnVfYnVyZ2VyX2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICQoJy5oZWFkZXJfX2J1cmdlci1tZW51X19saW5rJykucmVtb3ZlQ2xhc3MoJ2hlYWRlcl9fYnVyZ2VyLW1lbnVfX2xpbmtfYWN0aXZlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogU2Nyb2xsIFBhZ2UgdG8gdGhlIFRvcFxyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlXHJcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZ29Ub1RvcCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICQoJ2JvZHksIGh0bWwnKS5hbmltYXRlKHsgc2Nyb2xsVG9wOiAwIH0sIDYwMCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogU2hvd3MgYnVyZ2VyLW1lbnVcclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZVxyXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmJ1cmdlck1lbnUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnaGVhZGVyX19idXJnZXItbWVudV9fbGlua19hY3RpdmUnKSkge1xuICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2hlYWRlcl9fYnVyZ2VyLW1lbnVfX2xpbmtfYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgJCgnLmhlYWRlcl9fbWVudScpLnJlbW92ZUNsYXNzKCdoZWFkZXJfX21lbnVfYnVyZ2VyX2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5yZW1vdmVDbGFzcygnZml4ZWQnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnaGVhZGVyX19idXJnZXItbWVudV9fbGlua19hY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAkKCcuaGVhZGVyX19tZW51JykuYWRkQ2xhc3MoJ2hlYWRlcl9fbWVudV9idXJnZXJfYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgJCgnaHRtbCcpLmFkZENsYXNzKCdmaXhlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEluaXQgbW9kdWxlXHJcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gJCkpIHtcbiAgICAgICAgJC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgJC5tb2R1bGVzLmhlYWRlciA9IG5ldyBIZWFkZXIoKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiAkICYmICdtYWluJyBpbiAkLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIG5ldyBNYWluIGNsYXNzLlxyXG4gICAgICogQGNsYXNzXHJcbiAgICAgKi9cbiAgICB2YXIgTWFpbiA9IGZ1bmN0aW9uIE1haW4oKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICBzZWxmLndpbmRvdyA9ICQod2luZG93KTtcbiAgICAgICAgc2VsZi5odG1sID0gJCgnaHRtbCcpO1xuICAgICAgICBzZWxmLmJvZHkgPSAkKCdib2R5Jyk7XG4gICAgICAgIHNlbGYubW9kdWxlcyA9ICQubW9kdWxlcztcblxuICAgICAgICAvKipcclxuICAgICAgICAgKiBJbml0IGFsbCBtb2R1bGVzIGluICQubW9kdWxlc1xyXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXRNb2R1bGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZm9yICh2YXIgbW9kdWxlIGluIHNlbGYubW9kdWxlcykge1xuXG4gICAgICAgICAgICAgICAgaWYgKHNlbGYubW9kdWxlcy5oYXNPd25Qcm9wZXJ0eShtb2R1bGUpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWxmLm1vZHVsZXNbbW9kdWxlXS5pbml0ICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09ICdtYWluJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm1vZHVsZXNbbW9kdWxlXS5pbml0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSW5pdCBtb2R1bGVcclxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5pbml0TW9kdWxlcygpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gJCkpIHtcbiAgICAgICAgJC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgJC5tb2R1bGVzLm1haW4gPSBuZXcgTWFpbigpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluICQgJiYgJ21lbnUnIGluICQubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IE1lbnUgY2xhc3MuXHJcbiAgICAgKiBAY2xhc3NcclxuICAgICAqL1xuICAgIHZhciBNZW51ID0gZnVuY3Rpb24gTWVudSgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEFkZCBldmVudHMgbGlzdGVuZXJzXHJcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaGFzaCkge1xuICAgICAgICAgICAgICAgIHNlbGYuc2hvd1NlY3Rpb24od2luZG93LmxvY2F0aW9uLmhhc2gsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBzZWxmLmNoZWNrU2VjdGlvbik7XG5cbiAgICAgICAgICAgICQoJy5tZW51X19saW5rJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoISQoJy5oZWFkZXJfX21lbnUnKS5oYXNDbGFzcygnaGVhZGVyX19tZW51X2J1cmdlcl9hY3RpdmUnKSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dTZWN0aW9uKCQodGhpcykuYXR0cignaHJlZicpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dTZWN0aW9uKCQodGhpcykuYXR0cignaHJlZicpLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5yZW1vdmVDbGFzcygnZml4ZWQnKTtcbiAgICAgICAgICAgICAgICAkKCcuaGVhZGVyX19idXJnZXItbWVudV9fbGluaycpLnJlbW92ZUNsYXNzKCdoZWFkZXJfX2J1cmdlci1tZW51X19saW5rX2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICQoJy5oZWFkZXJfX21lbnUnKS5yZW1vdmVDbGFzcygnaGVhZGVyX19tZW51X2J1cmdlcl9hY3RpdmUnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENoZWNrIFNlY3Rpb24gKGFkZCBoYXNoIHRvIFVSTClcclxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5jaGVja1NlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCdzZWN0aW9uJykuZWFjaChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmRhdGEoJ3NlY3Rpb24nKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciB0b3BFZGdlID0gJHRoaXMub2Zmc2V0KCkudG9wIC0gMjUwO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYm90dG9tRWRnZSA9IHRvcEVkZ2UgKyAkdGhpcy5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdTY3JvbGwgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRvcEVkZ2UgPCB3U2Nyb2xsICYmIGJvdHRvbUVkZ2UgPiB3U2Nyb2xsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudElkID0gJHRoaXMuZGF0YSgnc2VjdGlvbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcUxpbmsgPSAkKCcubWVudV9fbGluaycpLmZpbHRlcignW2hyZWY9XCIjJyArIGN1cnJlbnRJZCArICdcIl0nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxTGluay5jbG9zZXN0KCcubWVudV9faXRlbScpLmFkZENsYXNzKCdtZW51X19pdGVtX2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ21lbnVfX2l0ZW1fYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9IGN1cnJlbnRJZDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLmRhdGEoJ3NlY3Rpb24nKSA9PT0gJ21haW4nKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSAkKCcubWVudV9faXRlbScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucmVtb3ZlQ2xhc3MoJ21lbnVfX2l0ZW1fYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTaG93IFNlY3Rpb25cclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gc2VjdGlvblxyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpc0FuaW1hdGVcclxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zaG93U2VjdGlvbiA9IGZ1bmN0aW9uIChzZWN0aW9uLCBpc0FuaW1hdGUpIHtcbiAgICAgICAgICAgIHZhciBkaXJlY3Rpb24gPSBzZWN0aW9uLnJlcGxhY2UoLyMvLCAnJyk7XG4gICAgICAgICAgICB2YXIgcmVxU2VjdGlvbiA9ICQoJ3NlY3Rpb24nKS5maWx0ZXIoJ1tkYXRhLXNlY3Rpb249XCInICsgZGlyZWN0aW9uICsgJ1wiXScpO1xuICAgICAgICAgICAgdmFyIHJlcVNlY3Rpb25Qb3MgPSByZXFTZWN0aW9uLm9mZnNldCgpLnRvcCAtICQoJy5oZWFkZXInKS5oZWlnaHQoKTtcblxuICAgICAgICAgICAgaWYgKGlzQW5pbWF0ZSkge1xuICAgICAgICAgICAgICAgICQoJ2JvZHksIGh0bWwnKS5hbmltYXRlKHsgc2Nyb2xsVG9wOiByZXFTZWN0aW9uUG9zIH0sIDYwMCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQoJ2JvZHksIGh0bWwnKS5zY3JvbGxUb3AocmVxU2VjdGlvblBvcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSW5pdCBtb2R1bGVcclxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiAkKSkge1xuICAgICAgICAkLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICAkLm1vZHVsZXMubWVudSA9IG5ldyBNZW51KCk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gJCAmJiAnbWFwJyBpbiAkLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgTWFwIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBNYXAgPSBmdW5jdGlvbiBNYXAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5zZXJ0IE1hcCB0byB0aGUgcGFnZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbnNlcnRNYXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgc3R5bGVBcnJheSA9IFt7XG4gICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICd3YXRlcicsXG4gICAgICAgICAgICAgICAgc3R5bGVyczogW3sgY29sb3I6ICcjMTg2OWRhJyB9XVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGZlYXR1cmVUeXBlOiAnbGFuZHNjYXBlJyxcbiAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogJ2dlb21ldHJ5LmZpbGwnLFxuICAgICAgICAgICAgICAgIHN0eWxlcnM6IFt7IGNvbG9yOiAnI2ZmZmZmZicgfV1cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ2xhbmRzY2FwZS5tYW5fbWFkZScsXG4gICAgICAgICAgICAgICAgZWxlbWVudFR5cGU6ICdhbGwnLFxuICAgICAgICAgICAgICAgIHN0eWxlcnM6IFt7IHNhdHVyYXRpb246ICctNzAnIH1dXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICdsYW5kc2NhcGUubmF0dXJhbCcsXG4gICAgICAgICAgICAgICAgZWxlbWVudFR5cGU6ICdhbGwnLFxuICAgICAgICAgICAgICAgIHN0eWxlcnM6IFt7IHZpc2liaWxpdHk6ICdvZmYnIH1dXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICdwb2knLFxuICAgICAgICAgICAgICAgIGVsZW1lbnRUeXBlOiAnbGFiZWxzJyxcbiAgICAgICAgICAgICAgICBzdHlsZXJzOiBbeyB2aXNpYmlsaXR5OiAnb2ZmJyB9XVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGZlYXR1cmVUeXBlOiAncG9pLnBhcmsnLFxuICAgICAgICAgICAgICAgIGVsZW1lbnRUeXBlOiAnYWxsJyxcbiAgICAgICAgICAgICAgICBzdHlsZXJzOiBbeyBjb2xvcjogJyNFRUVFRUUnIH1dXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICdyb2FkJyxcbiAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogJ2FsbCcsXG4gICAgICAgICAgICAgICAgc3R5bGVyczogW3sgbGlnaHRuZXNzOiAnLTUnIH1dXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICd0cmFuc2l0JyxcbiAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogJ2xhYmVscycsXG4gICAgICAgICAgICAgICAgc3R5bGVyczogW3sgdmlzaWJpbGl0eTogJ29mZicgfV1cbiAgICAgICAgICAgIH1dO1xuXG4gICAgICAgICAgICAvKmVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzKi8gLypubyBlcnJvcnMgd2hlbiB0YXNrIGd1bHAgZGVmdWx0IHJ1biovXG4gICAgICAgICAgICB2YXIgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICAgICAgICAgICAgICBjZW50ZXI6IHsgbGF0OiA1My45Mjk4NDcsIGxuZzogMjcuNTc2NDIwIH0sXG4gICAgICAgICAgICAgICAgc3R5bGVzOiBzdHlsZUFycmF5LFxuICAgICAgICAgICAgICAgIGRpc2FibGVEZWZhdWx0VUk6IHRydWUsXG4gICAgICAgICAgICAgICAgem9vbTogMTMsXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSgyNCwxMDUsMjE4LC4wNCknXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8qZXNsaW50LWVuYWJsZSBuby11bnVzZWQtdmFycyovXG5cbiAgICAgICAgICAgIHZhciBtYXJrZXJzID0gJCgnLm1hcCcpLmRhdGEoJ21hcmtlcnMnKTtcbiAgICAgICAgICAgIHZhciBpbWFnZSA9IHtcbiAgICAgICAgICAgICAgICB1cmw6ICdpbWFnZXMvdmlzLXBpbi1tYXAucG5nJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBtYXJrZXJzQXJyYXkgPSBbXTtcbiAgICAgICAgICAgIHZhciBpbmZvV2luZG93QXJyYXkgPSBbXTtcblxuICAgICAgICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoaSkge1xuICAgICAgICAgICAgICAgIHZhciBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHsgbGF0OiBtYXJrZXJzW2ldLmxhdCwgbG5nOiBtYXJrZXJzW2ldLmxuZyB9LFxuICAgICAgICAgICAgICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUCxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogaW1hZ2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSAnPGRpdiBjbGFzcz1cIm1hcC1pbmZvX190aXRsZVwiPicgKyBtYXJrZXJzW2ldLnRpdGxlICsgJzwvZGl2Pic7XG4gICAgICAgICAgICAgICAgdmFyIGFkZHJlc3MgPSAnPGRpdiBjbGFzcz1cIm1hcC1pbmZvX190ZXh0XCI+JyArIG1hcmtlcnNbaV0uYWRkcmVzcyArICc8L2Rpdj4nO1xuICAgICAgICAgICAgICAgIHZhciBjb250ZW50U3RyaW5nID0gdGl0bGUgKyBhZGRyZXNzO1xuICAgICAgICAgICAgICAgIHZhciBpbmZvV2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coe1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBjb250ZW50U3RyaW5nXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBtYXJrZXJzQXJyYXkucHVzaChtYXJrZXIpO1xuICAgICAgICAgICAgICAgIGluZm9XaW5kb3dBcnJheS5wdXNoKGluZm9XaW5kb3cpO1xuXG4gICAgICAgICAgICAgICAgbWFya2VyLmFkZExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IG1hcmtlcnNBcnJheS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm9XaW5kb3dBcnJheVtfaV0uY2xvc2UobWFwLCBtYXJrZXJzQXJyYXlbX2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpbmZvV2luZG93Lm9wZW4obWFwLCBtYXJrZXIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXJrZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgX2xvb3AoaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLmluc2VydE1hcCgpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gJCkpIHtcbiAgICAgICAgJC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgJC5tb2R1bGVzLm1hcCA9IG5ldyBNYXAoKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiAkICYmICdvd2wnIGluICQubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IE93bCBjbGFzcy5cclxuICAgICAqIEBjbGFzc1xyXG4gICAgICovXG4gICAgdmFyIE93bCA9IGZ1bmN0aW9uIE93bCgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENvdW50IHRoZSBudW1iZXIgb2YgaXRlbXMgaW4gdGhlIGNhcm91c2VsXHJcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGl0ZW1zXHJcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNvbnRhaW5lclxyXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmNvdW50SXRlbXMgPSBmdW5jdGlvbiAoaXRlbXMsIGNvbnRhaW5lcikge1xuICAgICAgICAgICAgdmFyIG5ld1RleHQgPSAnICcgKyBpdGVtcy5sZW5ndGg7XG5cbiAgICAgICAgICAgIGNvbnRhaW5lci5kYXRhKCdpdGVtcycsIGl0ZW1zLmxlbmd0aCk7XG4gICAgICAgICAgICBjb250YWluZXIudGV4dChuZXdUZXh0KTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluICQpKSB7XG4gICAgICAgICQubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgICQubW9kdWxlcy5vd2wgPSBuZXcgT3dsKCk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gJCAmJiAncmV2aWV3cycgaW4gJC5tb2R1bGVzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IFJldmlld3MgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIFJldmlld3MgPSBmdW5jdGlvbiBSZXZpZXdzKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9wZW5zIGZ1bGwgcmV2aWV3XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLm9wZW5GdWxsUmV2aWV3ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCgnLnJldmlld19faHJlZicpLmZhbmN5Ym94KHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnaW5saW5lJyxcbiAgICAgICAgICAgICAgICBtYXhXaWR0aDogNDYwLFxuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDAsXG4gICAgICAgICAgICAgICAgY2xvc2VCdG46IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLm9wZW5GdWxsUmV2aWV3KCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiAkKSkge1xuICAgICAgICAkLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICAkLm1vZHVsZXMucmV2aWV3cyA9IG5ldyBSZXZpZXdzKCk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gJCAmJiAnc3RlcHMnIGluICQubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IFN0ZXBzIGNsYXNzLlxyXG4gICAgICogQGNsYXNzXHJcbiAgICAgKi9cbiAgICB2YXIgU3RlcHMgPSBmdW5jdGlvbiBTdGVwcygpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEFkZCBldmVudHMgbGlzdGVuZXJzXHJcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQod2luZG93KS5vbigncmVzaXplJywgc2VsZi5hbmltYXRlU3RlcHMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIE1ha2VzIGVxdWFsIGhpZ2h0IG9mIHN0ZXBzLWl0ZW1zXHJcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZXF1YWxIaWdodCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gJCgnLnN0ZXBzX19pdGVtJyk7XG5cbiAgICAgICAgICAgIGl0ZW0ubWF0Y2hIZWlnaHQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcclxuICAgICAgICAgKiBBbmltYXRlIFN0ZXBzLVRhYmxldFxyXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmFuaW1hdGVTdGVwcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBvd2wgPSAkKCcuc3RlcHNfX2xpc3QnKTtcbiAgICAgICAgICAgIHZhciBuYXYgPSBvd2wubmV4dCgnLm93bC1uYXZpZ2F0aW9uJyk7XG4gICAgICAgICAgICB2YXIgYWxsUGFnZXMgPSBuYXYuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19hbGwtcGFnZXMnKTtcblxuICAgICAgICAgICAgaWYgKCQod2luZG93KS53aWR0aCgpIDw9ICcxMDIzJykge1xuICAgICAgICAgICAgICAgIGlmICghb3dsLmhhc0NsYXNzKCdvd2wtY2Fyb3VzZWwnKSkge1xuICAgICAgICAgICAgICAgICAgICBvd2wuYWRkQ2xhc3MoJ293bC1jYXJvdXNlbCcpLmFkZENsYXNzKCcub3dsLXRoZW1lJyk7XG4gICAgICAgICAgICAgICAgICAgIG93bC5vbignaW5pdGlhbGl6ZWQub3dsLmNhcm91c2VsJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gJCgnLnN0ZXBzX19pdGVtJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlSXRlbSA9IG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2FjdGl2ZS1wYWdlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uYWRkQ2xhc3MoJ3N0ZXBzX19pdGVtX2Nhcm91c2VsJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLm1hdGNoSGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVJdGVtLnRleHQoJzEgJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYXYuYWRkQ2xhc3MoJ293bC1uYXZpZ2F0aW9uX2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fbGlua19wcmV2JykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbFBhZ2VzLnRleHQoZS5pdGVtLmNvdW50IC0gKE1hdGguZmxvb3Iob3dsLndpZHRoKCkgLyBpdGVtLmlubmVyV2lkdGgoKSkgLSAxKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIG93bC5vd2xDYXJvdXNlbCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb29wOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVCeTogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNtYXJ0U3BlZWQ6IDMwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlRHJhZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZvOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2l2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDY0MToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogNCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW46IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlQnk6IDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIG93bC5vbignY2hhbmdlZC5vd2wuY2Fyb3VzZWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlSXRlbSA9IG93bC5maW5kKCcub3dsLWRvdC5hY3RpdmUnKS5pbmRleCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1RleHQgPSBhY3RpdmVJdGVtICsgMSArICcgJztcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBuYXYuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19hY3RpdmUtcGFnZScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXIudGV4dChuZXdUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmVJdGVtID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fbGlua19wcmV2JykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2xpbmtfcHJldicpLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChhY3RpdmVJdGVtICsgMSkudG9TdHJpbmcoKSA9PT0gbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fYWxsLXBhZ2VzJykudGV4dCgpLnJlcGxhY2UoXCIgXCIsIFwiXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fbGlua19uZXh0JykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2xpbmtfbmV4dCcpLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBuYXYuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19saW5rJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy5oYXNDbGFzcygnb3dsLW5hdmlnYXRpb25fX2xpbmtfcHJldicpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3dsLnRyaWdnZXIoJ3ByZXYub3dsLmNhcm91c2VsJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG93bC50cmlnZ2VyKCduZXh0Lm93bC5jYXJvdXNlbCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhbGxQYWdlcy50ZXh0KCQoJy5zdGVwc19fbGlzdCcpLm5leHQoJy5vd2wtbmF2aWdhdGlvbicpLmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fYWxsLXBhZ2VzJykuZGF0YSgnaXRlbXMnKSAtIChNYXRoLmZsb29yKG93bC53aWR0aCgpIC8gJCgnLnN0ZXBzX19pdGVtJykuaW5uZXJXaWR0aCgpKSAtIDEpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChvd2wuaGFzQ2xhc3MoJ293bC1jYXJvdXNlbCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIG93bC5vZmYoJ2NoYW5nZWQub3dsLmNhcm91c2VsJyk7XG4gICAgICAgICAgICAgICAgICAgIG93bC5yZW1vdmVDbGFzcygnb3dsLWNhcm91c2VsJykucmVtb3ZlQ2xhc3MoJy5vd2wtdGhlbWUnKTtcbiAgICAgICAgICAgICAgICAgICAgbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fbGluaycpLm9mZigpO1xuICAgICAgICAgICAgICAgICAgICBvd2wubmV4dCgnLm93bC1uYXZpZ2F0aW9uJykucmVtb3ZlQ2xhc3MoJ293bC1uYXZpZ2F0aW9uX2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICBvd2wudHJpZ2dlcignZGVzdHJveS5vd2wuY2Fyb3VzZWwnKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnLnN0ZXBzX19pdGVtJykucmVtb3ZlQ2xhc3MoJ3N0ZXBzX19pdGVtX2Nhcm91c2VsJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYuZXF1YWxIaWdodCgpO1xuICAgICAgICAgICAgJC5tb2R1bGVzLm93bC5jb3VudEl0ZW1zKCQoJy5zdGVwc19faXRlbScpLCAkKCcuc3RlcHNfX2xpc3QnKS5uZXh0KCcub3dsLW5hdmlnYXRpb24nKS5maW5kKCcub3dsLW5hdmlnYXRpb25fX2FsbC1wYWdlcycpKTtcbiAgICAgICAgICAgIHNlbGYuYW5pbWF0ZVN0ZXBzKCk7XG4gICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluICQpKSB7XG4gICAgICAgICQubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgICQubW9kdWxlcy5zdGVwcyA9IG5ldyBTdGVwcygpO1xufSkoKTsiLCIvKipcclxuICogSW5pdCBtYWluIG1vZHVsZVxyXG4gKi9cclxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xyXG4gICAgJC5tb2R1bGVzLm1haW4uaW5pdCgpO1xyXG59KTtcclxuIiwiKCgpID0+IHtcbiAgICBpZiAoJ21vZHVsZXMnIGluICQgJiYgJ2FkdmFudGFnZXMnIGluICQubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBBZHZhbnRhZ2VzIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIGNvbnN0IEFkdmFudGFnZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZCBldmVudHMgbGlzdGVuZXJzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZScsIHNlbGYuYW5pbWF0ZUFkdmFudGFnZXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFcXVhbEhlaWdodCBvZiB0aGUgaXRlbS10aXRsZXNcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZXF1YWxIZWlnaHQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxldCBpdGVtID0gJCgnLmFkdmFudGFnZXNfX2l0ZW1fX3RpdGxlJyk7XG5cbiAgICAgICAgICAgIGl0ZW0ubWF0Y2hIZWlnaHQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQW5pbWF0ZSBOZXR3b3JrLVRhYmxldFxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5hbmltYXRlQWR2YW50YWdlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbGV0IG93bCA9ICQoJy5hZHZhbnRhZ2VzX19saXN0Jyk7XG5cbiAgICAgICAgICAgIGlmICgkKHdpbmRvdykud2lkdGgoKSA8PSAnNjQwJykge1xuICAgICAgICAgICAgICAgIGlmICghb3dsLmhhc0NsYXNzKCdvd2wtY2Fyb3VzZWwnKSkge1xuICAgICAgICAgICAgICAgICAgICBvd2wuYWRkQ2xhc3MoJ293bC1jYXJvdXNlbCcpLmFkZENsYXNzKCcub3dsLXRoZW1lJyk7XG4gICAgICAgICAgICAgICAgICAgIG93bC5vbignaW5pdGlhbGl6ZWQub3dsLmNhcm91c2VsJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgaXRlbSA9ICQoJy5hZHZhbnRhZ2VzX19pdGVtJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ubWF0Y2hIZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgb3dsLm93bENhcm91c2VsKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3A6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNtYXJ0U3BlZWQ6IDMwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlRHJhZzogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAob3dsLmhhc0NsYXNzKCdvd2wtY2Fyb3VzZWwnKSkge1xuICAgICAgICAgICAgICAgICAgICBvd2wucmVtb3ZlQ2xhc3MoJ293bC1jYXJvdXNlbCcpLnJlbW92ZUNsYXNzKCcub3dsLXRoZW1lJyk7XG4gICAgICAgICAgICAgICAgICAgIG93bC50cmlnZ2VyKCdkZXN0cm95Lm93bC5jYXJvdXNlbCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9ICgpID0+IHtcbiAgICAgICAgICAgIHNlbGYuZXF1YWxIZWlnaHQoKTtcbiAgICAgICAgICAgIHNlbGYuYW5pbWF0ZUFkdmFudGFnZXMoKTtcbiAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gJCkpIHtcbiAgICAgICAgJC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgJC5tb2R1bGVzLmFkdmFudGFnZXMgPSBuZXcgQWR2YW50YWdlcygpO1xufSkoKTtcbiIsIigoKSA9PiB7XHJcbiAgICBpZiAoJ21vZHVsZXMnIGluICQgJiYgJ2hlYWRlcicgaW4gJC5tb2R1bGVzKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIG5ldyBIZWFkZXIgY2xhc3MuXHJcbiAgICAgKiBAY2xhc3NcclxuICAgICAqL1xyXG4gICAgY29uc3QgSGVhZGVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEFkZCBldmVudHMgbGlzdGVuZXJzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZScsIHNlbGYuc2hvd0hlYWRlck1lbnUpO1xyXG4gICAgICAgICAgICAkKCcuaGVhZGVyX19wcmV2aWV3X19saW5rJykub24oJ2NsaWNrJywgc2VsZi5nb1RvVG9wKTtcclxuICAgICAgICAgICAgJCgnLmhlYWRlcl9fYnVyZ2VyLW1lbnVfX2xpbmsnKS5vbignY2xpY2snLCBzZWxmLmJ1cmdlck1lbnUpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNob3dzIEhlYWRlck1lbnVcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLnNob3dIZWFkZXJNZW51ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGxldCBoZWFkZXJNZW51ID0gJCgnLmhlYWRlcl9fbWVudScpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCQod2luZG93KS53aWR0aCgpID49ICcxMDI0JyAmJiBoZWFkZXJNZW51Lmhhc0NsYXNzKCdoZWFkZXJfX21lbnVfYnVyZ2VyX2FjdGl2ZScpKSB7XHJcbiAgICAgICAgICAgICAgICBoZWFkZXJNZW51LnJlbW92ZUNsYXNzKCdoZWFkZXJfX21lbnVfYnVyZ2VyX2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgJCgnLmhlYWRlcl9fYnVyZ2VyLW1lbnVfX2xpbmsnKS5yZW1vdmVDbGFzcygnaGVhZGVyX19idXJnZXItbWVudV9fbGlua19hY3RpdmUnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNjcm9sbCBQYWdlIHRvIHRoZSBUb3BcclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHNlbGYuZ29Ub1RvcCA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgJCgnYm9keSwgaHRtbCcpLmFuaW1hdGUoe3Njcm9sbFRvcDogMH0sIDYwMCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogU2hvd3MgYnVyZ2VyLW1lbnVcclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHNlbGYuYnVyZ2VyTWVudSA9IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2hlYWRlcl9fYnVyZ2VyLW1lbnVfX2xpbmtfYWN0aXZlJykpIHtcclxuICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2hlYWRlcl9fYnVyZ2VyLW1lbnVfX2xpbmtfYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAkKCcuaGVhZGVyX19tZW51JykucmVtb3ZlQ2xhc3MoJ2hlYWRlcl9fbWVudV9idXJnZXJfYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAkKCdodG1sJykucmVtb3ZlQ2xhc3MoJ2ZpeGVkJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdoZWFkZXJfX2J1cmdlci1tZW51X19saW5rX2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgJCgnLmhlYWRlcl9fbWVudScpLmFkZENsYXNzKCdoZWFkZXJfX21lbnVfYnVyZ2VyX2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgJCgnaHRtbCcpLmFkZENsYXNzKCdmaXhlZCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSW5pdCBtb2R1bGVcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLmluaXQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGlmICghKCdtb2R1bGVzJyBpbiAkKSkge1xyXG4gICAgICAgICQubW9kdWxlcyA9IHt9O1xyXG4gICAgfVxyXG5cclxuICAgICQubW9kdWxlcy5oZWFkZXIgPSBuZXcgSGVhZGVyKCk7XHJcbn0pKCk7XHJcbiIsIigoKSA9PiB7XHJcbiAgICBpZiAoJ21vZHVsZXMnIGluICQgJiYgJ21haW4nIGluICQubW9kdWxlcykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgTWFpbiBjbGFzcy5cclxuICAgICAqIEBjbGFzc1xyXG4gICAgICovXHJcbiAgICBjb25zdCBNYWluID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHNlbGYud2luZG93ID0gJCh3aW5kb3cpO1xyXG4gICAgICAgIHNlbGYuaHRtbCA9ICQoJ2h0bWwnKTtcclxuICAgICAgICBzZWxmLmJvZHkgPSAkKCdib2R5Jyk7XHJcbiAgICAgICAgc2VsZi5tb2R1bGVzID0gJC5tb2R1bGVzO1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBJbml0IGFsbCBtb2R1bGVzIGluICQubW9kdWxlc1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHNlbGYuaW5pdE1vZHVsZXMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgbW9kdWxlIGluIHNlbGYubW9kdWxlcykge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzZWxmLm1vZHVsZXMuaGFzT3duUHJvcGVydHkobW9kdWxlKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNlbGYubW9kdWxlc1ttb2R1bGVdLmluaXQgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZSAhPT0gJ21haW4nKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm1vZHVsZXNbbW9kdWxlXS5pbml0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSW5pdCBtb2R1bGVcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgc2VsZi5pbml0TW9kdWxlcygpO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGlmICghKCdtb2R1bGVzJyBpbiAkKSkge1xyXG4gICAgICAgICQubW9kdWxlcyA9IHt9O1xyXG4gICAgfVxyXG5cclxuICAgICQubW9kdWxlcy5tYWluID0gbmV3IE1haW4oKTtcclxufSkoKTtcclxuIiwiKCgpID0+IHtcclxuICAgIGlmICgnbW9kdWxlcycgaW4gJCAmJiAnbWVudScgaW4gJC5tb2R1bGVzKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIG5ldyBNZW51IGNsYXNzLlxyXG4gICAgICogQGNsYXNzXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IE1lbnUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQWRkIGV2ZW50cyBsaXN0ZW5lcnNcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaGFzaCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5zaG93U2VjdGlvbih3aW5kb3cubG9jYXRpb24uaGFzaCwgZmFsc2UpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkKHdpbmRvdykub24oJ3Njcm9sbCcsIHNlbGYuY2hlY2tTZWN0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICQoJy5tZW51X19saW5rJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghJCgnLmhlYWRlcl9fbWVudScpLmhhc0NsYXNzKCdoZWFkZXJfX21lbnVfYnVyZ2VyX2FjdGl2ZScpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zaG93U2VjdGlvbigkKHRoaXMpLmF0dHIoJ2hyZWYnKSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd1NlY3Rpb24oJCh0aGlzKS5hdHRyKCdocmVmJyksIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5yZW1vdmVDbGFzcygnZml4ZWQnKTtcclxuICAgICAgICAgICAgICAgICQoJy5oZWFkZXJfX2J1cmdlci1tZW51X19saW5rJykucmVtb3ZlQ2xhc3MoJ2hlYWRlcl9fYnVyZ2VyLW1lbnVfX2xpbmtfYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAkKCcuaGVhZGVyX19tZW51JykucmVtb3ZlQ2xhc3MoJ2hlYWRlcl9fbWVudV9idXJnZXJfYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENoZWNrIFNlY3Rpb24gKGFkZCBoYXNoIHRvIFVSTClcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLmNoZWNrU2VjdGlvbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkKCdzZWN0aW9uJykuZWFjaChmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgJHRoaXMgPSAkKHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkdGhpcy5kYXRhKCdzZWN0aW9uJykpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHRvcEVkZ2UgPSAkdGhpcy5vZmZzZXQoKS50b3AgLSAyNTA7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJvdHRvbUVkZ2UgPSB0b3BFZGdlICsgJHRoaXMuaGVpZ2h0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHdTY3JvbGwgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0b3BFZGdlIDwgd1Njcm9sbCAmJiBib3R0b21FZGdlID4gd1Njcm9sbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY3VycmVudElkID0gJHRoaXMuZGF0YSgnc2VjdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVxTGluayA9ICQoJy5tZW51X19saW5rJykuZmlsdGVyKCdbaHJlZj1cIiMnICsgY3VycmVudElkICsgJ1wiXScpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxTGluay5jbG9zZXN0KCcubWVudV9faXRlbScpLmFkZENsYXNzKCdtZW51X19pdGVtX2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ21lbnVfX2l0ZW1fYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gY3VycmVudElkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLmRhdGEoJ3NlY3Rpb24nKSA9PT0gJ21haW4nKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGl0ZW1zID0gJCgnLm1lbnVfX2l0ZW0nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5yZW1vdmVDbGFzcygnbWVudV9faXRlbV9hY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNob3cgU2VjdGlvblxyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzZWN0aW9uXHJcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGlzQW5pbWF0ZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHNlbGYuc2hvd1NlY3Rpb24gPSBmdW5jdGlvbihzZWN0aW9uLCBpc0FuaW1hdGUpIHtcclxuICAgICAgICAgICAgbGV0IGRpcmVjdGlvbiA9IHNlY3Rpb24ucmVwbGFjZSgvIy8sICcnKTtcclxuICAgICAgICAgICAgbGV0IHJlcVNlY3Rpb24gPSAkKCdzZWN0aW9uJykuZmlsdGVyKCdbZGF0YS1zZWN0aW9uPVwiJyArIGRpcmVjdGlvbiArICdcIl0nKTtcclxuICAgICAgICAgICAgbGV0IHJlcVNlY3Rpb25Qb3MgPSByZXFTZWN0aW9uLm9mZnNldCgpLnRvcC0kKCcuaGVhZGVyJykuaGVpZ2h0KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNBbmltYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAkKCdib2R5LCBodG1sJykuYW5pbWF0ZSh7c2Nyb2xsVG9wOiByZXFTZWN0aW9uUG9zfSwgNjAwKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICQoJ2JvZHksIGh0bWwnKS5zY3JvbGxUb3AocmVxU2VjdGlvblBvcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBJbml0IG1vZHVsZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHNlbGYuaW5pdCA9ICgpID0+IHtcclxuICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluICQpKSB7XHJcbiAgICAgICAgJC5tb2R1bGVzID0ge307XHJcbiAgICB9XHJcblxyXG4gICAgJC5tb2R1bGVzLm1lbnUgPSBuZXcgTWVudSgpO1xyXG59KSgpO1xyXG4iLCIoKCkgPT4ge1xuICAgIGlmICgnbW9kdWxlcycgaW4gJCAmJiAnbWFwJyBpbiAkLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgTWFwIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIGNvbnN0IE1hcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5zZXJ0IE1hcCB0byB0aGUgcGFnZVxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbnNlcnRNYXAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxldCBzdHlsZUFycmF5ID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICd3YXRlcicsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlcnM6IFt7Y29sb3I6ICcjMTg2OWRhJ31dXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGZlYXR1cmVUeXBlOiAnbGFuZHNjYXBlJyxcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFR5cGU6ICdnZW9tZXRyeS5maWxsJyxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVyczogW3tjb2xvcjogJyNmZmZmZmYnfV1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICdsYW5kc2NhcGUubWFuX21hZGUnLFxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogJ2FsbCcsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlcnM6IFt7c2F0dXJhdGlvbjogJy03MCd9XVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ2xhbmRzY2FwZS5uYXR1cmFsJyxcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFR5cGU6ICdhbGwnLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZXJzOiBbe3Zpc2liaWxpdHk6ICdvZmYnfV1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICdwb2knLFxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogJ2xhYmVscycsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlcnM6IFt7dmlzaWJpbGl0eTogJ29mZid9XVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ3BvaS5wYXJrJyxcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFR5cGU6ICdhbGwnLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZXJzOiBbe2NvbG9yOiAnI0VFRUVFRSd9XVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ3JvYWQnLFxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogJ2FsbCcsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlcnM6IFt7bGlnaHRuZXNzOiAnLTUnfV1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICd0cmFuc2l0JyxcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFR5cGU6ICdsYWJlbHMnLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZXJzOiBbe3Zpc2liaWxpdHk6ICdvZmYnfV1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICAvKmVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzKi8gLypubyBlcnJvcnMgd2hlbiB0YXNrIGd1bHAgZGVmdWx0IHJ1biovXG4gICAgICAgICAgICBsZXQgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICAgICAgICAgICAgICBjZW50ZXI6IHtsYXQ6IDUzLjkyOTg0NywgbG5nOiAyNy41NzY0MjB9LFxuICAgICAgICAgICAgICAgIHN0eWxlczogc3R5bGVBcnJheSxcbiAgICAgICAgICAgICAgICBkaXNhYmxlRGVmYXVsdFVJOiB0cnVlLFxuICAgICAgICAgICAgICAgIHpvb206IDEzLFxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMjQsMTA1LDIxOCwuMDQpJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvKmVzbGludC1lbmFibGUgbm8tdW51c2VkLXZhcnMqL1xuXG4gICAgICAgICAgICBsZXQgbWFya2VycyA9ICQoJy5tYXAnKS5kYXRhKCdtYXJrZXJzJyk7XG4gICAgICAgICAgICBsZXQgaW1hZ2UgPSB7XG4gICAgICAgICAgICAgICAgdXJsOiAnaW1hZ2VzL3Zpcy1waW4tbWFwLnBuZydcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBsZXQgbWFya2Vyc0FycmF5ID0gW107XG4gICAgICAgICAgICBsZXQgaW5mb1dpbmRvd0FycmF5ID0gW107XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWFya2Vycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGxldCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHtsYXQ6IG1hcmtlcnNbaV0ubGF0LCBsbmc6IG1hcmtlcnNbaV0ubG5nfSxcbiAgICAgICAgICAgICAgICAgICAgbWFwOiBtYXAsXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1AsXG4gICAgICAgICAgICAgICAgICAgIGljb246IGltYWdlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdGl0bGUgPSBgPGRpdiBjbGFzcz1cIm1hcC1pbmZvX190aXRsZVwiPiR7bWFya2Vyc1tpXS50aXRsZX08L2Rpdj5gO1xuICAgICAgICAgICAgICAgIGNvbnN0IGFkZHJlc3MgPSBgPGRpdiBjbGFzcz1cIm1hcC1pbmZvX190ZXh0XCI+JHttYXJrZXJzW2ldLmFkZHJlc3N9PC9kaXY+YDtcbiAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50U3RyaW5nID0gdGl0bGUgKyBhZGRyZXNzO1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZm9XaW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRTdHJpbmdcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIG1hcmtlcnNBcnJheS5wdXNoKG1hcmtlcik7XG4gICAgICAgICAgICAgICAgaW5mb1dpbmRvd0FycmF5LnB1c2goaW5mb1dpbmRvdyk7XG5cbiAgICAgICAgICAgICAgICBtYXJrZXIuYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWFya2Vyc0FycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZvV2luZG93QXJyYXlbaV0uY2xvc2UobWFwLCBtYXJrZXJzQXJyYXlbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGluZm9XaW5kb3cub3BlbihtYXAsIG1hcmtlcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSAoKSA9PiB7XG4gICAgICAgICAgICBzZWxmLmluc2VydE1hcCgpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gJCkpIHtcbiAgICAgICAgJC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgJC5tb2R1bGVzLm1hcCA9IG5ldyBNYXAoKTtcbn0pKCk7XG4iLCIoKCkgPT4ge1xyXG4gICAgaWYgKCdtb2R1bGVzJyBpbiAkICYmICdvd2wnIGluICQubW9kdWxlcykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgT3dsIGNsYXNzLlxyXG4gICAgICogQGNsYXNzXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IE93bCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBDb3VudCB0aGUgbnVtYmVyIG9mIGl0ZW1zIGluIHRoZSBjYXJvdXNlbFxyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtc1xyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb250YWluZXJcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLmNvdW50SXRlbXMgPSBmdW5jdGlvbihpdGVtcywgY29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIGxldCBuZXdUZXh0ID0gJyAnICsgaXRlbXMubGVuZ3RoO1xyXG5cclxuICAgICAgICAgICAgY29udGFpbmVyLmRhdGEoJ2l0ZW1zJywgaXRlbXMubGVuZ3RoKTtcclxuICAgICAgICAgICAgY29udGFpbmVyLnRleHQobmV3VGV4dCk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluICQpKSB7XHJcbiAgICAgICAgJC5tb2R1bGVzID0ge307XHJcbiAgICB9XHJcblxyXG4gICAgJC5tb2R1bGVzLm93bCA9IG5ldyBPd2woKTtcclxufSkoKTtcclxuIiwiKCgpID0+IHtcbiAgICBpZiAoJ21vZHVsZXMnIGluICQgJiYgJ3Jldmlld3MnIGluICQubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBSZXZpZXdzIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIGNvbnN0IFJldmlld3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9wZW5zIGZ1bGwgcmV2aWV3XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLm9wZW5GdWxsUmV2aWV3ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKCcucmV2aWV3X19ocmVmJykuZmFuY3lib3goe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdpbmxpbmUnLFxuICAgICAgICAgICAgICAgIG1heFdpZHRoOiA0NjAsXG4gICAgICAgICAgICAgICAgcGFkZGluZzogMCxcbiAgICAgICAgICAgICAgICBjbG9zZUJ0bjogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNlbGYuaW5pdCA9ICgpID0+IHtcbiAgICAgICAgICAgIHNlbGYub3BlbkZ1bGxSZXZpZXcoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluICQpKSB7XG4gICAgICAgICQubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgICQubW9kdWxlcy5yZXZpZXdzID0gbmV3IFJldmlld3MoKTtcbn0pKCk7XG4iLCIoKCkgPT4ge1xyXG4gICAgaWYgKCdtb2R1bGVzJyBpbiAkICYmICdzdGVwcycgaW4gJC5tb2R1bGVzKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIG5ldyBTdGVwcyBjbGFzcy5cclxuICAgICAqIEBjbGFzc1xyXG4gICAgICovXHJcbiAgICBjb25zdCBTdGVwcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBBZGQgZXZlbnRzIGxpc3RlbmVyc1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9ICgpID0+IHtcclxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdyZXNpemUnLCBzZWxmLmFuaW1hdGVTdGVwcyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogTWFrZXMgZXF1YWwgaGlnaHQgb2Ygc3RlcHMtaXRlbXNcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLmVxdWFsSGlnaHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgbGV0IGl0ZW0gPSAkKCcuc3RlcHNfX2l0ZW0nKTtcclxuXHJcbiAgICAgICAgICAgIGl0ZW0ubWF0Y2hIZWlnaHQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBBbmltYXRlIFN0ZXBzLVRhYmxldFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHNlbGYuYW5pbWF0ZVN0ZXBzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGxldCBvd2wgPSAkKCcuc3RlcHNfX2xpc3QnKTtcclxuICAgICAgICAgICAgbGV0IG5hdiA9IG93bC5uZXh0KCcub3dsLW5hdmlnYXRpb24nKTtcclxuICAgICAgICAgICAgbGV0IGFsbFBhZ2VzID0gbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fYWxsLXBhZ2VzJyk7XHJcblxyXG4gICAgICAgICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPD0gJzEwMjMnKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW93bC5oYXNDbGFzcygnb3dsLWNhcm91c2VsJykpIHtcclxuICAgICAgICAgICAgICAgICAgICBvd2wuYWRkQ2xhc3MoJ293bC1jYXJvdXNlbCcpLmFkZENsYXNzKCcub3dsLXRoZW1lJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgb3dsLm9uKCdpbml0aWFsaXplZC5vd2wuY2Fyb3VzZWwnLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpdGVtID0gJCgnLnN0ZXBzX19pdGVtJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhY3RpdmVJdGVtID0gbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fYWN0aXZlLXBhZ2UnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uYWRkQ2xhc3MoJ3N0ZXBzX19pdGVtX2Nhcm91c2VsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ubWF0Y2hIZWlnaHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlSXRlbS50ZXh0KCcxICcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXYuYWRkQ2xhc3MoJ293bC1uYXZpZ2F0aW9uX2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXYuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19saW5rX3ByZXYnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbFBhZ2VzLnRleHQoZS5pdGVtLmNvdW50IC0gKE1hdGguZmxvb3Iob3dsLndpZHRoKCkvaXRlbS5pbm5lcldpZHRoKCkpLTEpKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgb3dsLm93bENhcm91c2VsKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9vcDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRvV2lkdGg6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlQnk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNtYXJ0U3BlZWQ6IDMwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbW91c2VEcmFnOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5mbzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2l2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgNjQxOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IDQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbjogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZUJ5OiAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgb3dsLm9uKCdjaGFuZ2VkLm93bC5jYXJvdXNlbCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgYWN0aXZlSXRlbSA9IG93bC5maW5kKCcub3dsLWRvdC5hY3RpdmUnKS5pbmRleCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgbmV3VGV4dCA9IGFjdGl2ZUl0ZW0gKyAxICsgJyAnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY29udGFpbmVyID0gbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fYWN0aXZlLXBhZ2UnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci50ZXh0KG5ld1RleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlSXRlbSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fbGlua19wcmV2JykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXYuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19saW5rX3ByZXYnKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGFjdGl2ZUl0ZW0rMSkudG9TdHJpbmcoKSA9PT0gbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fYWxsLXBhZ2VzJykudGV4dCgpLnJlcGxhY2UoXCIgXCIsIFwiXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXYuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19saW5rX25leHQnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2xpbmtfbmV4dCcpLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2xpbmsnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0ICR0aGlzID0gJCh0aGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy5oYXNDbGFzcygnb3dsLW5hdmlnYXRpb25fX2xpbmtfcHJldicpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvd2wudHJpZ2dlcigncHJldi5vd2wuY2Fyb3VzZWwnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG93bC50cmlnZ2VyKCduZXh0Lm93bC5jYXJvdXNlbCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGFsbFBhZ2VzLnRleHQoJCgnLnN0ZXBzX19saXN0JykubmV4dCgnLm93bC1uYXZpZ2F0aW9uJykuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19hbGwtcGFnZXMnKS5kYXRhKCdpdGVtcycpIC0gKE1hdGguZmxvb3Iob3dsLndpZHRoKCkvJCgnLnN0ZXBzX19pdGVtJykuaW5uZXJXaWR0aCgpKS0xKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob3dsLmhhc0NsYXNzKCdvd2wtY2Fyb3VzZWwnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG93bC5vZmYoJ2NoYW5nZWQub3dsLmNhcm91c2VsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgb3dsLnJlbW92ZUNsYXNzKCdvd2wtY2Fyb3VzZWwnKS5yZW1vdmVDbGFzcygnLm93bC10aGVtZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2xpbmsnKS5vZmYoKTtcclxuICAgICAgICAgICAgICAgICAgICBvd2wubmV4dCgnLm93bC1uYXZpZ2F0aW9uJykucmVtb3ZlQ2xhc3MoJ293bC1uYXZpZ2F0aW9uX2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIG93bC50cmlnZ2VyKCdkZXN0cm95Lm93bC5jYXJvdXNlbCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5zdGVwc19faXRlbScpLnJlbW92ZUNsYXNzKCdzdGVwc19faXRlbV9jYXJvdXNlbCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgc2VsZi5pbml0ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBzZWxmLmVxdWFsSGlnaHQoKTtcclxuICAgICAgICAgICAgJC5tb2R1bGVzLm93bC5jb3VudEl0ZW1zKCQoJy5zdGVwc19faXRlbScpLCAkKCcuc3RlcHNfX2xpc3QnKS5uZXh0KCcub3dsLW5hdmlnYXRpb24nKS5maW5kKCcub3dsLW5hdmlnYXRpb25fX2FsbC1wYWdlcycpKTtcclxuICAgICAgICAgICAgc2VsZi5hbmltYXRlU3RlcHMoKTtcclxuICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluICQpKSB7XHJcbiAgICAgICAgJC5tb2R1bGVzID0ge307XHJcbiAgICB9XHJcblxyXG4gICAgJC5tb2R1bGVzLnN0ZXBzID0gbmV3IFN0ZXBzKCk7XHJcbn0pKCk7XHJcbiJdfQ==
