"use strict";$(document).ready(function(){$.modules.main.init()}),function(){if(!("modules"in $&&"advantages"in $.modules)){var e=function(){var e=this;e.setupListener=function(){$(window).on("resize",e.animateAdvantages)},e.equalHeight=function(){var e=$(".advantages__item__title");e.matchHeight()},e.animateAdvantages=function(){var e=$(".advantages__list");$(window).width()<="640"?e.hasClass("owl-carousel")||(e.addClass("owl-carousel").addClass(".owl-theme"),e.on("initialized.owl.carousel",function(){var e=$(".advantages__item");e.matchHeight()}),e.owlCarousel({loop:!0,items:1,smartSpeed:300,mouseDrag:!1})):e.hasClass("owl-carousel")&&(e.removeClass("owl-carousel").removeClass(".owl-theme"),e.trigger("destroy.owl.carousel"))},e.init=function(){e.equalHeight(),e.animateAdvantages(),e.setupListener()}};"modules"in $||($.modules={}),$.modules.advantages=new e}}(),function(){if(!("modules"in $&&"header"in $.modules)){var e=function(){var e=this;e.setupListener=function(){$(window).on("resize",e.showHeaderMenu),$(".header__preview__link").on("click",e.goToTop),$(".header__burger-menu__link").on("click",e.burgerMenu)},e.showHeaderMenu=function(){var e=$(".header__menu");$(window).width()>="1024"&&e.hasClass("header__menu_burger_active")&&(e.removeClass("header__menu_burger_active"),$(".header__burger-menu__link").removeClass("header__burger-menu__link_active"))},e.goToTop=function(e){e.preventDefault(),$("body, html").animate({scrollTop:0},600)},e.burgerMenu=function(e){e.preventDefault(),$(this).hasClass("header__burger-menu__link_active")?($(this).removeClass("header__burger-menu__link_active"),$(".header__menu").removeClass("header__menu_burger_active"),$("html").removeClass("fixed")):($(this).addClass("header__burger-menu__link_active"),$(".header__menu").addClass("header__menu_burger_active"),$("html").addClass("fixed"))},e.init=function(){e.setupListener()}};"modules"in $||($.modules={}),$.modules.header=new e}}(),function(){if(!("modules"in $&&"main"in $.modules)){var e=function(){var e=this;e.window=$(window),e.html=$("html"),e.body=$("body"),e.modules=$.modules,e.initModules=function(){for(var i in e.modules)e.modules.hasOwnProperty(i)&&"undefined"!=typeof e.modules[i].init&&"main"!==i&&e.modules[i].init()},e.init=function(){e.initModules()}};"modules"in $||($.modules={}),$.modules.main=new e}}(),function(){if(!("modules"in $&&"map"in $.modules)){var e=function(){var e=this;e.insertMap=function(){for(var e=[{featureType:"water",stylers:[{color:"#1869da"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{saturation:"-70"}]},{featureType:"landscape.natural",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"all",stylers:[{color:"#EEEEEE"}]},{featureType:"road",elementType:"all",stylers:[{lightness:"-5"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]}],i=new google.maps.Map(document.getElementById("map"),{center:{lat:53.929847,lng:27.57642},styles:e,disableDefaultUI:!0,zoom:14,backgroundColor:"rgba(24,105,218,.04)"}),n=$(".map").data("markers"),a={url:"../images/vis-pin-map.png"},t=[],o=[],s=function(e){var s=new google.maps.Marker({position:{lat:n[e].lat,lng:n[e].lng},map:i,animation:google.maps.Animation.DROP,icon:a}),l='<div class="map-info__title">'+n[e].title+"</div>",r='<div class="map-info__text">'+n[e].address+"</div>",u=l+r,d=new google.maps.InfoWindow({content:u});t.push(s),o.push(d),s.addListener("click",function(){for(var e=0;e<t.length;e++)o[e].close(i,t[e]);d.open(i,s)})},l=0;l<n.length;l++)s(l)},e.init=function(){e.insertMap()}};"modules"in $||($.modules={}),$.modules.map=new e}}(),function(){if(!("modules"in $&&"menu"in $.modules)){var e=function(){var e=this;e.setupListener=function(){window.location.hash&&e.showSection(window.location.hash,!1),$(window).on("scroll",e.checkSection),$(".menu__link").on("click",function(i){i.preventDefault(),$(".header__menu").hasClass("header__menu_burger_active")?e.showSection($(this).attr("href"),!1):e.showSection($(this).attr("href"),!0),$("html").removeClass("fixed"),$(".header__burger-menu__link").removeClass("header__burger-menu__link_active"),$(".header__menu").removeClass("header__menu_burger_active")})},e.checkSection=function(){$("section").each(function(){var e=$(this);if(e.data("section")){var i=e.offset().top-250,n=i+e.height(),a=$(window).scrollTop();if(i<a&&n>a){var t=e.data("section"),o=$(".menu__link").filter('[href="#'+t+'"]');if(o.closest(".menu__item").addClass("menu__item_active").siblings().removeClass("menu__item_active"),window.location.hash=t,"main"===e.data("section")){var s=$(".menu__item");s.removeClass("menu__item_active")}}}})},e.showSection=function(e,i){var n=e.replace(/#/,""),a=$("section").filter('[data-section="'+n+'"]'),t=a.offset().top-$(".header").height();i?$("body, html").animate({scrollTop:t},600):$("body, html").scrollTop(t)},e.init=function(){e.setupListener()}};"modules"in $||($.modules={}),$.modules.menu=new e}}(),function(){if(!("modules"in $&&"owl"in $.modules)){var e=function(){var e=this;e.countItems=function(e,i){var n=" "+e.length;i.data("items",e.length),i.text(n)}};"modules"in $||($.modules={}),$.modules.owl=new e}}(),function(){if(!("modules"in $&&"reviews"in $.modules)){var e=function(){var e=this;e.openFullReview=function(){$(".review__href").fancybox({type:"inline",maxWidth:460,padding:0,closeBtn:!1})},e.init=function(){e.openFullReview()}};"modules"in $||($.modules={}),$.modules.reviews=new e}}(),function(){if(!("modules"in $&&"steps"in $.modules)){var e=function(){var e=this;e.setupListener=function(){$(window).on("resize",e.animateSteps)},e.equalHight=function(){var e=$(".steps__item");e.matchHeight()},e.animateSteps=function(){var e=$(".steps__list"),i=e.next(".owl-navigation"),n=i.find(".owl-navigation__all-pages");$(window).width()<="1023"?e.hasClass("owl-carousel")?n.text($(".steps__list").next(".owl-navigation").find(".owl-navigation__all-pages").data("items")-(Math.floor(e.width()/$(".steps__item").innerWidth())-1)):(e.addClass("owl-carousel").addClass(".owl-theme"),e.on("initialized.owl.carousel",function(a){var t=$(".steps__item"),o=i.find(".owl-navigation__active-page");t.addClass("steps__item_carousel"),t.matchHeight(),o.text("1 "),i.addClass("owl-navigation_active"),i.find(".owl-navigation__link_prev").addClass("disabled"),n.text(a.item.count-(Math.floor(e.width()/t.innerWidth())-1))}),e.owlCarousel({loop:!1,items:1,autoWidth:!0,slideBy:1,smartSpeed:300,mouseDrag:!1,info:!0,responsive:{641:{items:4,autoWidth:!0,margin:0,slideBy:1}}}),e.on("changed.owl.carousel",function(){var n=e.find(".owl-dot.active").index(),a=n+1+" ",t=i.find(".owl-navigation__active-page");t.text(a),0===n?i.find(".owl-navigation__link_prev").addClass("disabled"):i.find(".owl-navigation__link_prev").removeClass("disabled"),(n+1).toString()===i.find(".owl-navigation__all-pages").text().replace(" ","")?i.find(".owl-navigation__link_next").addClass("disabled"):i.find(".owl-navigation__link_next").removeClass("disabled")}),i.find(".owl-navigation__link").on("click",function(i){i.preventDefault();var n=$(this);n.hasClass("owl-navigation__link_prev")?e.trigger("prev.owl.carousel"):e.trigger("next.owl.carousel")})):e.hasClass("owl-carousel")&&(e.off("changed.owl.carousel"),e.removeClass("owl-carousel").removeClass(".owl-theme"),i.find(".owl-navigation__link").off(),e.next(".owl-navigation").removeClass("owl-navigation_active"),e.trigger("destroy.owl.carousel"),$(".steps__item").removeClass("steps__item_carousel"))},e.init=function(){e.equalHight(),$.modules.owl.countItems($(".steps__item"),$(".steps__list").next(".owl-navigation").find(".owl-navigation__all-pages")),e.animateSteps(),e.setupListener()}};"modules"in $||($.modules={}),$.modules.steps=new e}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4ubWluLmpzIiwibWFpbi5qcyIsImFkdmFudGFnZXMvYWR2YW50YWdlcy5qcyIsImhlYWRlci9oZWFkZXIuanMiLCJtYWluL21haW4uanMiLCJtYXAvbWFwLmpzIiwibWVudS9tZW51LmpzIiwib3dsQ2Fyb3VzZWwvb3dsQ2Fyb3VzZWwuanMiLCJyZXZpZXdzL3Jldmlld3MuanMiLCJzdGVwcy9zdGVwcy5qcyJdLCJuYW1lcyI6WyIkIiwiZG9jdW1lbnQiLCJyZWFkeSIsIm1vZHVsZXMiLCJtYWluIiwiaW5pdCIsIkFkdmFudGFnZXMiLCJzZWxmIiwidGhpcyIsInNldHVwTGlzdGVuZXIiLCJ3aW5kb3ciLCJvbiIsImFuaW1hdGVBZHZhbnRhZ2VzIiwiZXF1YWxIZWlnaHQiLCJpdGVtIiwibWF0Y2hIZWlnaHQiLCJvd2wiLCJ3aWR0aCIsImhhc0NsYXNzIiwiYWRkQ2xhc3MiLCJvd2xDYXJvdXNlbCIsImxvb3AiLCJpdGVtcyIsInNtYXJ0U3BlZWQiLCJtb3VzZURyYWciLCJyZW1vdmVDbGFzcyIsInRyaWdnZXIiLCJhZHZhbnRhZ2VzIiwiSGVhZGVyIiwic2hvd0hlYWRlck1lbnUiLCJnb1RvVG9wIiwiYnVyZ2VyTWVudSIsImhlYWRlck1lbnUiLCJlIiwicHJldmVudERlZmF1bHQiLCJhbmltYXRlIiwic2Nyb2xsVG9wIiwiaGVhZGVyIiwiTWFpbiIsImh0bWwiLCJib2R5IiwiaW5pdE1vZHVsZXMiLCJtb2R1bGUiLCJoYXNPd25Qcm9wZXJ0eSIsIk1hcCIsImluc2VydE1hcCIsInN0eWxlQXJyYXkiLCJmZWF0dXJlVHlwZSIsInN0eWxlcnMiLCJjb2xvciIsImVsZW1lbnRUeXBlIiwic2F0dXJhdGlvbiIsInZpc2liaWxpdHkiLCJsaWdodG5lc3MiLCJtYXAiLCJnb29nbGUiLCJtYXBzIiwiZ2V0RWxlbWVudEJ5SWQiLCJjZW50ZXIiLCJsYXQiLCJsbmciLCJzdHlsZXMiLCJkaXNhYmxlRGVmYXVsdFVJIiwiem9vbSIsImJhY2tncm91bmRDb2xvciIsIm1hcmtlcnMiLCJkYXRhIiwiaW1hZ2UiLCJ1cmwiLCJtYXJrZXJzQXJyYXkiLCJpbmZvV2luZG93QXJyYXkiLCJfbG9vcCIsImkiLCJtYXJrZXIiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImFuaW1hdGlvbiIsIkFuaW1hdGlvbiIsIkRST1AiLCJpY29uIiwidGl0bGUiLCJhZGRyZXNzIiwiY29udGVudFN0cmluZyIsImluZm9XaW5kb3ciLCJJbmZvV2luZG93IiwiY29udGVudCIsInB1c2giLCJhZGRMaXN0ZW5lciIsImxlbmd0aCIsImNsb3NlIiwib3BlbiIsIk1lbnUiLCJsb2NhdGlvbiIsImhhc2giLCJzaG93U2VjdGlvbiIsImNoZWNrU2VjdGlvbiIsImF0dHIiLCJlYWNoIiwiJHRoaXMiLCJ0b3BFZGdlIiwib2Zmc2V0IiwidG9wIiwiYm90dG9tRWRnZSIsImhlaWdodCIsIndTY3JvbGwiLCJjdXJyZW50SWQiLCJyZXFMaW5rIiwiZmlsdGVyIiwiY2xvc2VzdCIsInNpYmxpbmdzIiwic2VjdGlvbiIsImlzQW5pbWF0ZSIsImRpcmVjdGlvbiIsInJlcGxhY2UiLCJyZXFTZWN0aW9uIiwicmVxU2VjdGlvblBvcyIsIm1lbnUiLCJPd2wiLCJjb3VudEl0ZW1zIiwiY29udGFpbmVyIiwibmV3VGV4dCIsInRleHQiLCJSZXZpZXdzIiwib3BlbkZ1bGxSZXZpZXciLCJmYW5jeWJveCIsInR5cGUiLCJtYXhXaWR0aCIsInBhZGRpbmciLCJjbG9zZUJ0biIsInJldmlld3MiLCJTdGVwcyIsImFuaW1hdGVTdGVwcyIsImVxdWFsSGlnaHQiLCJuYXYiLCJuZXh0IiwiYWxsUGFnZXMiLCJmaW5kIiwiTWF0aCIsImZsb29yIiwiaW5uZXJXaWR0aCIsImFjdGl2ZUl0ZW0iLCJjb3VudCIsImF1dG9XaWR0aCIsInNsaWRlQnkiLCJpbmZvIiwicmVzcG9uc2l2ZSIsIjY0MSIsIm1hcmdpbiIsImluZGV4IiwidG9TdHJpbmciLCJvZmYiLCJzdGVwcyJdLCJtYXBwaW5ncyI6IkFBQUEsWUNHQUEsR0FBQUMsVUFB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IiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4vKipcclxuICogSW5pdCBtYWluIG1vZHVsZVxyXG4gKi9cbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAkLm1vZHVsZXMubWFpbi5pbml0KCk7XG59KTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluICQgJiYgJ2FkdmFudGFnZXMnIGluICQubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBBZHZhbnRhZ2VzIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBBZHZhbnRhZ2VzID0gZnVuY3Rpb24gQWR2YW50YWdlcygpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnRzIGxpc3RlbmVyc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdyZXNpemUnLCBzZWxmLmFuaW1hdGVBZHZhbnRhZ2VzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRXF1YWxIZWlnaHQgb2YgdGhlIGl0ZW0tdGl0bGVzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmVxdWFsSGVpZ2h0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKCcuYWR2YW50YWdlc19faXRlbV9fdGl0bGUnKTtcblxuICAgICAgICAgICAgaXRlbS5tYXRjaEhlaWdodCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbmltYXRlIE5ldHdvcmstVGFibGV0XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmFuaW1hdGVBZHZhbnRhZ2VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIG93bCA9ICQoJy5hZHZhbnRhZ2VzX19saXN0Jyk7XG5cbiAgICAgICAgICAgIGlmICgkKHdpbmRvdykud2lkdGgoKSA8PSAnNjQwJykge1xuICAgICAgICAgICAgICAgIGlmICghb3dsLmhhc0NsYXNzKCdvd2wtY2Fyb3VzZWwnKSkge1xuICAgICAgICAgICAgICAgICAgICBvd2wuYWRkQ2xhc3MoJ293bC1jYXJvdXNlbCcpLmFkZENsYXNzKCcub3dsLXRoZW1lJyk7XG4gICAgICAgICAgICAgICAgICAgIG93bC5vbignaW5pdGlhbGl6ZWQub3dsLmNhcm91c2VsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSAkKCcuYWR2YW50YWdlc19faXRlbScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLm1hdGNoSGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIG93bC5vd2xDYXJvdXNlbCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb29wOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBzbWFydFNwZWVkOiAzMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtb3VzZURyYWc6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG93bC5oYXNDbGFzcygnb3dsLWNhcm91c2VsJykpIHtcbiAgICAgICAgICAgICAgICAgICAgb3dsLnJlbW92ZUNsYXNzKCdvd2wtY2Fyb3VzZWwnKS5yZW1vdmVDbGFzcygnLm93bC10aGVtZScpO1xuICAgICAgICAgICAgICAgICAgICBvd2wudHJpZ2dlcignZGVzdHJveS5vd2wuY2Fyb3VzZWwnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLmVxdWFsSGVpZ2h0KCk7XG4gICAgICAgICAgICBzZWxmLmFuaW1hdGVBZHZhbnRhZ2VzKCk7XG4gICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluICQpKSB7XG4gICAgICAgICQubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgICQubW9kdWxlcy5hZHZhbnRhZ2VzID0gbmV3IEFkdmFudGFnZXMoKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiAkICYmICdoZWFkZXInIGluICQubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IEhlYWRlciBjbGFzcy5cclxuICAgICAqIEBjbGFzc1xyXG4gICAgICovXG4gICAgdmFyIEhlYWRlciA9IGZ1bmN0aW9uIEhlYWRlcigpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEFkZCBldmVudHMgbGlzdGVuZXJzXHJcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQod2luZG93KS5vbigncmVzaXplJywgc2VsZi5zaG93SGVhZGVyTWVudSk7XG4gICAgICAgICAgICAkKCcuaGVhZGVyX19wcmV2aWV3X19saW5rJykub24oJ2NsaWNrJywgc2VsZi5nb1RvVG9wKTtcbiAgICAgICAgICAgICQoJy5oZWFkZXJfX2J1cmdlci1tZW51X19saW5rJykub24oJ2NsaWNrJywgc2VsZi5idXJnZXJNZW51KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTaG93cyBIZWFkZXJNZW51XHJcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2hvd0hlYWRlck1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgaGVhZGVyTWVudSA9ICQoJy5oZWFkZXJfX21lbnUnKTtcblxuICAgICAgICAgICAgaWYgKCQod2luZG93KS53aWR0aCgpID49ICcxMDI0JyAmJiBoZWFkZXJNZW51Lmhhc0NsYXNzKCdoZWFkZXJfX21lbnVfYnVyZ2VyX2FjdGl2ZScpKSB7XG4gICAgICAgICAgICAgICAgaGVhZGVyTWVudS5yZW1vdmVDbGFzcygnaGVhZGVyX19tZW51X2J1cmdlcl9hY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAkKCcuaGVhZGVyX19idXJnZXItbWVudV9fbGluaycpLnJlbW92ZUNsYXNzKCdoZWFkZXJfX2J1cmdlci1tZW51X19saW5rX2FjdGl2ZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNjcm9sbCBQYWdlIHRvIHRoZSBUb3BcclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZVxyXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmdvVG9Ub3AgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAkKCdib2R5LCBodG1sJykuYW5pbWF0ZSh7IHNjcm9sbFRvcDogMCB9LCA2MDApO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNob3dzIGJ1cmdlci1tZW51XHJcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGVcclxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5idXJnZXJNZW51ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2hlYWRlcl9fYnVyZ2VyLW1lbnVfX2xpbmtfYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdoZWFkZXJfX2J1cmdlci1tZW51X19saW5rX2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICQoJy5oZWFkZXJfX21lbnUnKS5yZW1vdmVDbGFzcygnaGVhZGVyX19tZW51X2J1cmdlcl9hY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAkKCdodG1sJykucmVtb3ZlQ2xhc3MoJ2ZpeGVkJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2hlYWRlcl9fYnVyZ2VyLW1lbnVfX2xpbmtfYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgJCgnLmhlYWRlcl9fbWVudScpLmFkZENsYXNzKCdoZWFkZXJfX21lbnVfYnVyZ2VyX2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5hZGRDbGFzcygnZml4ZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcclxuICAgICAgICAgKiBJbml0IG1vZHVsZVxyXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluICQpKSB7XG4gICAgICAgICQubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgICQubW9kdWxlcy5oZWFkZXIgPSBuZXcgSGVhZGVyKCk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gJCAmJiAnbWFpbicgaW4gJC5tb2R1bGVzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgTWFpbiBjbGFzcy5cclxuICAgICAqIEBjbGFzc1xyXG4gICAgICovXG4gICAgdmFyIE1haW4gPSBmdW5jdGlvbiBNYWluKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgc2VsZi53aW5kb3cgPSAkKHdpbmRvdyk7XG4gICAgICAgIHNlbGYuaHRtbCA9ICQoJ2h0bWwnKTtcbiAgICAgICAgc2VsZi5ib2R5ID0gJCgnYm9keScpO1xuICAgICAgICBzZWxmLm1vZHVsZXMgPSAkLm1vZHVsZXM7XG5cbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSW5pdCBhbGwgbW9kdWxlcyBpbiAkLm1vZHVsZXNcclxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0TW9kdWxlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGZvciAodmFyIG1vZHVsZSBpbiBzZWxmLm1vZHVsZXMpIHtcblxuICAgICAgICAgICAgICAgIGlmIChzZWxmLm1vZHVsZXMuaGFzT3duUHJvcGVydHkobW9kdWxlKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2VsZi5tb2R1bGVzW21vZHVsZV0uaW5pdCAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlICE9PSAnbWFpbicpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5tb2R1bGVzW21vZHVsZV0uaW5pdCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEluaXQgbW9kdWxlXHJcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYuaW5pdE1vZHVsZXMoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluICQpKSB7XG4gICAgICAgICQubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgICQubW9kdWxlcy5tYWluID0gbmV3IE1haW4oKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiAkICYmICdtYXAnIGluICQubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBNYXAgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIE1hcCA9IGZ1bmN0aW9uIE1hcCgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbnNlcnQgTWFwIHRvIHRoZSBwYWdlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluc2VydE1hcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzdHlsZUFycmF5ID0gW3tcbiAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ3dhdGVyJyxcbiAgICAgICAgICAgICAgICBzdHlsZXJzOiBbeyBjb2xvcjogJyMxODY5ZGEnIH1dXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICdsYW5kc2NhcGUnLFxuICAgICAgICAgICAgICAgIGVsZW1lbnRUeXBlOiAnZ2VvbWV0cnkuZmlsbCcsXG4gICAgICAgICAgICAgICAgc3R5bGVyczogW3sgY29sb3I6ICcjZmZmZmZmJyB9XVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGZlYXR1cmVUeXBlOiAnbGFuZHNjYXBlLm1hbl9tYWRlJyxcbiAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogJ2FsbCcsXG4gICAgICAgICAgICAgICAgc3R5bGVyczogW3sgc2F0dXJhdGlvbjogJy03MCcgfV1cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ2xhbmRzY2FwZS5uYXR1cmFsJyxcbiAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogJ2FsbCcsXG4gICAgICAgICAgICAgICAgc3R5bGVyczogW3sgdmlzaWJpbGl0eTogJ29mZicgfV1cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ3BvaScsXG4gICAgICAgICAgICAgICAgZWxlbWVudFR5cGU6ICdsYWJlbHMnLFxuICAgICAgICAgICAgICAgIHN0eWxlcnM6IFt7IHZpc2liaWxpdHk6ICdvZmYnIH1dXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICdwb2kucGFyaycsXG4gICAgICAgICAgICAgICAgZWxlbWVudFR5cGU6ICdhbGwnLFxuICAgICAgICAgICAgICAgIHN0eWxlcnM6IFt7IGNvbG9yOiAnI0VFRUVFRScgfV1cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ3JvYWQnLFxuICAgICAgICAgICAgICAgIGVsZW1lbnRUeXBlOiAnYWxsJyxcbiAgICAgICAgICAgICAgICBzdHlsZXJzOiBbeyBsaWdodG5lc3M6ICctNScgfV1cbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ3RyYW5zaXQnLFxuICAgICAgICAgICAgICAgIGVsZW1lbnRUeXBlOiAnbGFiZWxzJyxcbiAgICAgICAgICAgICAgICBzdHlsZXJzOiBbeyB2aXNpYmlsaXR5OiAnb2ZmJyB9XVxuICAgICAgICAgICAgfV07XG5cbiAgICAgICAgICAgIC8qZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMqLyAvKm5vIGVycm9ycyB3aGVuIHRhc2sgZ3VscCBkZWZ1bHQgcnVuKi9cbiAgICAgICAgICAgIHZhciBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgICAgICAgICAgIGNlbnRlcjogeyBsYXQ6IDUzLjkyOTg0NywgbG5nOiAyNy41NzY0MjAgfSxcbiAgICAgICAgICAgICAgICBzdHlsZXM6IHN0eWxlQXJyYXksXG4gICAgICAgICAgICAgICAgZGlzYWJsZURlZmF1bHRVSTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB6b29tOiAxNCxcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICdyZ2JhKDI0LDEwNSwyMTgsLjA0KSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLyplc2xpbnQtZW5hYmxlIG5vLXVudXNlZC12YXJzKi9cblxuICAgICAgICAgICAgdmFyIG1hcmtlcnMgPSAkKCcubWFwJykuZGF0YSgnbWFya2VycycpO1xuICAgICAgICAgICAgdmFyIGltYWdlID0ge1xuICAgICAgICAgICAgICAgIHVybDogJy4uL2ltYWdlcy92aXMtcGluLW1hcC5wbmcnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIG1hcmtlcnNBcnJheSA9IFtdO1xuICAgICAgICAgICAgdmFyIGluZm9XaW5kb3dBcnJheSA9IFtdO1xuXG4gICAgICAgICAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcChpKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogeyBsYXQ6IG1hcmtlcnNbaV0ubGF0LCBsbmc6IG1hcmtlcnNbaV0ubG5nIH0sXG4gICAgICAgICAgICAgICAgICAgIG1hcDogbWFwLFxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QLFxuICAgICAgICAgICAgICAgICAgICBpY29uOiBpbWFnZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZhciB0aXRsZSA9ICc8ZGl2IGNsYXNzPVwibWFwLWluZm9fX3RpdGxlXCI+JyArIG1hcmtlcnNbaV0udGl0bGUgKyAnPC9kaXY+JztcbiAgICAgICAgICAgICAgICB2YXIgYWRkcmVzcyA9ICc8ZGl2IGNsYXNzPVwibWFwLWluZm9fX3RleHRcIj4nICsgbWFya2Vyc1tpXS5hZGRyZXNzICsgJzwvZGl2Pic7XG4gICAgICAgICAgICAgICAgdmFyIGNvbnRlbnRTdHJpbmcgPSB0aXRsZSArIGFkZHJlc3M7XG4gICAgICAgICAgICAgICAgdmFyIGluZm9XaW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRTdHJpbmdcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIG1hcmtlcnNBcnJheS5wdXNoKG1hcmtlcik7XG4gICAgICAgICAgICAgICAgaW5mb1dpbmRvd0FycmF5LnB1c2goaW5mb1dpbmRvdyk7XG5cbiAgICAgICAgICAgICAgICBtYXJrZXIuYWRkTGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgbWFya2Vyc0FycmF5Lmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5mb1dpbmRvd0FycmF5W19pXS5jbG9zZShtYXAsIG1hcmtlcnNBcnJheVtfaV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGluZm9XaW5kb3cub3BlbihtYXAsIG1hcmtlcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hcmtlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBfbG9vcChpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYuaW5zZXJ0TWFwKCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiAkKSkge1xuICAgICAgICAkLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICAkLm1vZHVsZXMubWFwID0gbmV3IE1hcCgpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluICQgJiYgJ21lbnUnIGluICQubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IE1lbnUgY2xhc3MuXHJcbiAgICAgKiBAY2xhc3NcclxuICAgICAqL1xuICAgIHZhciBNZW51ID0gZnVuY3Rpb24gTWVudSgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEFkZCBldmVudHMgbGlzdGVuZXJzXHJcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaGFzaCkge1xuICAgICAgICAgICAgICAgIHNlbGYuc2hvd1NlY3Rpb24od2luZG93LmxvY2F0aW9uLmhhc2gsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBzZWxmLmNoZWNrU2VjdGlvbik7XG5cbiAgICAgICAgICAgICQoJy5tZW51X19saW5rJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoISQoJy5oZWFkZXJfX21lbnUnKS5oYXNDbGFzcygnaGVhZGVyX19tZW51X2J1cmdlcl9hY3RpdmUnKSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dTZWN0aW9uKCQodGhpcykuYXR0cignaHJlZicpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dTZWN0aW9uKCQodGhpcykuYXR0cignaHJlZicpLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5yZW1vdmVDbGFzcygnZml4ZWQnKTtcbiAgICAgICAgICAgICAgICAkKCcuaGVhZGVyX19idXJnZXItbWVudV9fbGluaycpLnJlbW92ZUNsYXNzKCdoZWFkZXJfX2J1cmdlci1tZW51X19saW5rX2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICQoJy5oZWFkZXJfX21lbnUnKS5yZW1vdmVDbGFzcygnaGVhZGVyX19tZW51X2J1cmdlcl9hY3RpdmUnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENoZWNrIFNlY3Rpb24gKGFkZCBoYXNoIHRvIFVSTClcclxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5jaGVja1NlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCdzZWN0aW9uJykuZWFjaChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCR0aGlzLmRhdGEoJ3NlY3Rpb24nKSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciB0b3BFZGdlID0gJHRoaXMub2Zmc2V0KCkudG9wIC0gMjUwO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYm90dG9tRWRnZSA9IHRvcEVkZ2UgKyAkdGhpcy5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHdTY3JvbGwgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRvcEVkZ2UgPCB3U2Nyb2xsICYmIGJvdHRvbUVkZ2UgPiB3U2Nyb2xsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudElkID0gJHRoaXMuZGF0YSgnc2VjdGlvbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcUxpbmsgPSAkKCcubWVudV9fbGluaycpLmZpbHRlcignW2hyZWY9XCIjJyArIGN1cnJlbnRJZCArICdcIl0nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVxTGluay5jbG9zZXN0KCcubWVudV9faXRlbScpLmFkZENsYXNzKCdtZW51X19pdGVtX2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ21lbnVfX2l0ZW1fYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9IGN1cnJlbnRJZDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCR0aGlzLmRhdGEoJ3NlY3Rpb24nKSA9PT0gJ21haW4nKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSAkKCcubWVudV9faXRlbScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucmVtb3ZlQ2xhc3MoJ21lbnVfX2l0ZW1fYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTaG93IFNlY3Rpb25cclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gc2VjdGlvblxyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpc0FuaW1hdGVcclxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zaG93U2VjdGlvbiA9IGZ1bmN0aW9uIChzZWN0aW9uLCBpc0FuaW1hdGUpIHtcbiAgICAgICAgICAgIHZhciBkaXJlY3Rpb24gPSBzZWN0aW9uLnJlcGxhY2UoLyMvLCAnJyk7XG4gICAgICAgICAgICB2YXIgcmVxU2VjdGlvbiA9ICQoJ3NlY3Rpb24nKS5maWx0ZXIoJ1tkYXRhLXNlY3Rpb249XCInICsgZGlyZWN0aW9uICsgJ1wiXScpO1xuICAgICAgICAgICAgdmFyIHJlcVNlY3Rpb25Qb3MgPSByZXFTZWN0aW9uLm9mZnNldCgpLnRvcCAtICQoJy5oZWFkZXInKS5oZWlnaHQoKTtcblxuICAgICAgICAgICAgaWYgKGlzQW5pbWF0ZSkge1xuICAgICAgICAgICAgICAgICQoJ2JvZHksIGh0bWwnKS5hbmltYXRlKHsgc2Nyb2xsVG9wOiByZXFTZWN0aW9uUG9zIH0sIDYwMCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQoJ2JvZHksIGh0bWwnKS5zY3JvbGxUb3AocmVxU2VjdGlvblBvcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSW5pdCBtb2R1bGVcclxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiAkKSkge1xuICAgICAgICAkLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICAkLm1vZHVsZXMubWVudSA9IG5ldyBNZW51KCk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIGlmICgnbW9kdWxlcycgaW4gJCAmJiAnb3dsJyBpbiAkLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIG5ldyBPd2wgY2xhc3MuXHJcbiAgICAgKiBAY2xhc3NcclxuICAgICAqL1xuICAgIHZhciBPd2wgPSBmdW5jdGlvbiBPd2woKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAvKipcclxuICAgICAgICAgKiBDb3VudCB0aGUgbnVtYmVyIG9mIGl0ZW1zIGluIHRoZSBjYXJvdXNlbFxyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtc1xyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb250YWluZXJcclxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5jb3VudEl0ZW1zID0gZnVuY3Rpb24gKGl0ZW1zLCBjb250YWluZXIpIHtcbiAgICAgICAgICAgIHZhciBuZXdUZXh0ID0gJyAnICsgaXRlbXMubGVuZ3RoO1xuXG4gICAgICAgICAgICBjb250YWluZXIuZGF0YSgnaXRlbXMnLCBpdGVtcy5sZW5ndGgpO1xuICAgICAgICAgICAgY29udGFpbmVyLnRleHQobmV3VGV4dCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiAkKSkge1xuICAgICAgICAkLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICAkLm1vZHVsZXMub3dsID0gbmV3IE93bCgpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluICQgJiYgJ3Jldmlld3MnIGluICQubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBSZXZpZXdzIGNsYXNzLlxuICAgICAqIEBjbGFzc1xuICAgICAqL1xuICAgIHZhciBSZXZpZXdzID0gZnVuY3Rpb24gUmV2aWV3cygpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcGVucyBmdWxsIHJldmlld1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5vcGVuRnVsbFJldmlldyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQoJy5yZXZpZXdfX2hyZWYnKS5mYW5jeWJveCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2lubGluZScsXG4gICAgICAgICAgICAgICAgbWF4V2lkdGg6IDQ2MCxcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwLFxuICAgICAgICAgICAgICAgIGNsb3NlQnRuOiBmYWxzZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2VsZi5vcGVuRnVsbFJldmlldygpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBpZiAoISgnbW9kdWxlcycgaW4gJCkpIHtcbiAgICAgICAgJC5tb2R1bGVzID0ge307XG4gICAgfVxuXG4gICAgJC5tb2R1bGVzLnJldmlld3MgPSBuZXcgUmV2aWV3cygpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJ21vZHVsZXMnIGluICQgJiYgJ3N0ZXBzJyBpbiAkLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIG5ldyBTdGVwcyBjbGFzcy5cclxuICAgICAqIEBjbGFzc1xyXG4gICAgICovXG4gICAgdmFyIFN0ZXBzID0gZnVuY3Rpb24gU3RlcHMoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAvKipcclxuICAgICAgICAgKiBBZGQgZXZlbnRzIGxpc3RlbmVyc1xyXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKHdpbmRvdykub24oJ3Jlc2l6ZScsIHNlbGYuYW5pbWF0ZVN0ZXBzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcclxuICAgICAgICAgKiBNYWtlcyBlcXVhbCBoaWdodCBvZiBzdGVwcy1pdGVtc1xyXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmVxdWFsSGlnaHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgaXRlbSA9ICQoJy5zdGVwc19faXRlbScpO1xuXG4gICAgICAgICAgICBpdGVtLm1hdGNoSGVpZ2h0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQW5pbWF0ZSBTdGVwcy1UYWJsZXRcclxuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5hbmltYXRlU3RlcHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgb3dsID0gJCgnLnN0ZXBzX19saXN0Jyk7XG4gICAgICAgICAgICB2YXIgbmF2ID0gb3dsLm5leHQoJy5vd2wtbmF2aWdhdGlvbicpO1xuICAgICAgICAgICAgdmFyIGFsbFBhZ2VzID0gbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fYWxsLXBhZ2VzJyk7XG5cbiAgICAgICAgICAgIGlmICgkKHdpbmRvdykud2lkdGgoKSA8PSAnMTAyMycpIHtcbiAgICAgICAgICAgICAgICBpZiAoIW93bC5oYXNDbGFzcygnb3dsLWNhcm91c2VsJykpIHtcbiAgICAgICAgICAgICAgICAgICAgb3dsLmFkZENsYXNzKCdvd2wtY2Fyb3VzZWwnKS5hZGRDbGFzcygnLm93bC10aGVtZScpO1xuICAgICAgICAgICAgICAgICAgICBvd2wub24oJ2luaXRpYWxpemVkLm93bC5jYXJvdXNlbCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9ICQoJy5zdGVwc19faXRlbScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2ZUl0ZW0gPSBuYXYuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19hY3RpdmUtcGFnZScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmFkZENsYXNzKCdzdGVwc19faXRlbV9jYXJvdXNlbCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5tYXRjaEhlaWdodCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlSXRlbS50ZXh0KCcxICcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmF2LmFkZENsYXNzKCdvd2wtbmF2aWdhdGlvbl9hY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2xpbmtfcHJldicpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxQYWdlcy50ZXh0KGUuaXRlbS5jb3VudCAtIChNYXRoLmZsb29yKG93bC53aWR0aCgpIC8gaXRlbS5pbm5lcldpZHRoKCkpIC0gMSkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBvd2wub3dsQ2Fyb3VzZWwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9vcDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlQnk6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBzbWFydFNwZWVkOiAzMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtb3VzZURyYWc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW5mbzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNpdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA2NDE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IDQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFyZ2luOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGlkZUJ5OiAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBvd2wub24oJ2NoYW5nZWQub3dsLmNhcm91c2VsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGl2ZUl0ZW0gPSBvd2wuZmluZCgnLm93bC1kb3QuYWN0aXZlJykuaW5kZXgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdUZXh0ID0gYWN0aXZlSXRlbSArIDEgKyAnICc7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyID0gbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fYWN0aXZlLXBhZ2UnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnRleHQobmV3VGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlSXRlbSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2xpbmtfcHJldicpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXYuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19saW5rX3ByZXYnKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoYWN0aXZlSXRlbSArIDEpLnRvU3RyaW5nKCkgPT09IG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2FsbC1wYWdlcycpLnRleHQoKS5yZXBsYWNlKFwiIFwiLCBcIlwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2xpbmtfbmV4dCcpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXYuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19saW5rX25leHQnKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fbGluaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMuaGFzQ2xhc3MoJ293bC1uYXZpZ2F0aW9uX19saW5rX3ByZXYnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG93bC50cmlnZ2VyKCdwcmV2Lm93bC5jYXJvdXNlbCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvd2wudHJpZ2dlcignbmV4dC5vd2wuY2Fyb3VzZWwnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYWxsUGFnZXMudGV4dCgkKCcuc3RlcHNfX2xpc3QnKS5uZXh0KCcub3dsLW5hdmlnYXRpb24nKS5maW5kKCcub3dsLW5hdmlnYXRpb25fX2FsbC1wYWdlcycpLmRhdGEoJ2l0ZW1zJykgLSAoTWF0aC5mbG9vcihvd2wud2lkdGgoKSAvICQoJy5zdGVwc19faXRlbScpLmlubmVyV2lkdGgoKSkgLSAxKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAob3dsLmhhc0NsYXNzKCdvd2wtY2Fyb3VzZWwnKSkge1xuICAgICAgICAgICAgICAgICAgICBvd2wub2ZmKCdjaGFuZ2VkLm93bC5jYXJvdXNlbCcpO1xuICAgICAgICAgICAgICAgICAgICBvd2wucmVtb3ZlQ2xhc3MoJ293bC1jYXJvdXNlbCcpLnJlbW92ZUNsYXNzKCcub3dsLXRoZW1lJyk7XG4gICAgICAgICAgICAgICAgICAgIG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2xpbmsnKS5vZmYoKTtcbiAgICAgICAgICAgICAgICAgICAgb3dsLm5leHQoJy5vd2wtbmF2aWdhdGlvbicpLnJlbW92ZUNsYXNzKCdvd2wtbmF2aWdhdGlvbl9hY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgb3dsLnRyaWdnZXIoJ2Rlc3Ryb3kub3dsLmNhcm91c2VsJyk7XG4gICAgICAgICAgICAgICAgICAgICQoJy5zdGVwc19faXRlbScpLnJlbW92ZUNsYXNzKCdzdGVwc19faXRlbV9jYXJvdXNlbCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLmluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZWxmLmVxdWFsSGlnaHQoKTtcbiAgICAgICAgICAgICQubW9kdWxlcy5vd2wuY291bnRJdGVtcygkKCcuc3RlcHNfX2l0ZW0nKSwgJCgnLnN0ZXBzX19saXN0JykubmV4dCgnLm93bC1uYXZpZ2F0aW9uJykuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19hbGwtcGFnZXMnKSk7XG4gICAgICAgICAgICBzZWxmLmFuaW1hdGVTdGVwcygpO1xuICAgICAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyKCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiAkKSkge1xuICAgICAgICAkLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICAkLm1vZHVsZXMuc3RlcHMgPSBuZXcgU3RlcHMoKTtcbn0pKCk7IiwiLyoqXHJcbiAqIEluaXQgbWFpbiBtb2R1bGVcclxuICovXHJcbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcclxuICAgICQubW9kdWxlcy5tYWluLmluaXQoKTtcclxufSk7XHJcbiIsIigoKSA9PiB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiAkICYmICdhZHZhbnRhZ2VzJyBpbiAkLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgQWR2YW50YWdlcyBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICBjb25zdCBBZHZhbnRhZ2VzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgZXZlbnRzIGxpc3RlbmVyc1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gKCkgPT4ge1xuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdyZXNpemUnLCBzZWxmLmFuaW1hdGVBZHZhbnRhZ2VzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRXF1YWxIZWlnaHQgb2YgdGhlIGl0ZW0tdGl0bGVzXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmVxdWFsSGVpZ2h0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBsZXQgaXRlbSA9ICQoJy5hZHZhbnRhZ2VzX19pdGVtX190aXRsZScpO1xuXG4gICAgICAgICAgICBpdGVtLm1hdGNoSGVpZ2h0KCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFuaW1hdGUgTmV0d29yay1UYWJsZXRcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuYW5pbWF0ZUFkdmFudGFnZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxldCBvd2wgPSAkKCcuYWR2YW50YWdlc19fbGlzdCcpO1xuXG4gICAgICAgICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPD0gJzY0MCcpIHtcbiAgICAgICAgICAgICAgICBpZiAoIW93bC5oYXNDbGFzcygnb3dsLWNhcm91c2VsJykpIHtcbiAgICAgICAgICAgICAgICAgICAgb3dsLmFkZENsYXNzKCdvd2wtY2Fyb3VzZWwnKS5hZGRDbGFzcygnLm93bC10aGVtZScpO1xuICAgICAgICAgICAgICAgICAgICBvd2wub24oJ2luaXRpYWxpemVkLm93bC5jYXJvdXNlbCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGl0ZW0gPSAkKCcuYWR2YW50YWdlc19faXRlbScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLm1hdGNoSGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIG93bC5vd2xDYXJvdXNlbCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb29wOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBzbWFydFNwZWVkOiAzMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtb3VzZURyYWc6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKG93bC5oYXNDbGFzcygnb3dsLWNhcm91c2VsJykpIHtcbiAgICAgICAgICAgICAgICAgICAgb3dsLnJlbW92ZUNsYXNzKCdvd2wtY2Fyb3VzZWwnKS5yZW1vdmVDbGFzcygnLm93bC10aGVtZScpO1xuICAgICAgICAgICAgICAgICAgICBvd2wudHJpZ2dlcignZGVzdHJveS5vd2wuY2Fyb3VzZWwnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXQgbW9kdWxlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluaXQgPSAoKSA9PiB7XG4gICAgICAgICAgICBzZWxmLmVxdWFsSGVpZ2h0KCk7XG4gICAgICAgICAgICBzZWxmLmFuaW1hdGVBZHZhbnRhZ2VzKCk7XG4gICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgaWYgKCEoJ21vZHVsZXMnIGluICQpKSB7XG4gICAgICAgICQubW9kdWxlcyA9IHt9O1xuICAgIH1cblxuICAgICQubW9kdWxlcy5hZHZhbnRhZ2VzID0gbmV3IEFkdmFudGFnZXMoKTtcbn0pKCk7XG4iLCIoKCkgPT4ge1xyXG4gICAgaWYgKCdtb2R1bGVzJyBpbiAkICYmICdoZWFkZXInIGluICQubW9kdWxlcykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgSGVhZGVyIGNsYXNzLlxyXG4gICAgICogQGNsYXNzXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IEhlYWRlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBBZGQgZXZlbnRzIGxpc3RlbmVyc1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lciA9ICgpID0+IHtcclxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdyZXNpemUnLCBzZWxmLnNob3dIZWFkZXJNZW51KTtcclxuICAgICAgICAgICAgJCgnLmhlYWRlcl9fcHJldmlld19fbGluaycpLm9uKCdjbGljaycsIHNlbGYuZ29Ub1RvcCk7XHJcbiAgICAgICAgICAgICQoJy5oZWFkZXJfX2J1cmdlci1tZW51X19saW5rJykub24oJ2NsaWNrJywgc2VsZi5idXJnZXJNZW51KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTaG93cyBIZWFkZXJNZW51XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgc2VsZi5zaG93SGVhZGVyTWVudSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBsZXQgaGVhZGVyTWVudSA9ICQoJy5oZWFkZXJfX21lbnUnKTtcclxuXHJcbiAgICAgICAgICAgIGlmICgkKHdpbmRvdykud2lkdGgoKSA+PSAnMTAyNCcgJiYgaGVhZGVyTWVudS5oYXNDbGFzcygnaGVhZGVyX19tZW51X2J1cmdlcl9hY3RpdmUnKSkge1xyXG4gICAgICAgICAgICAgICAgaGVhZGVyTWVudS5yZW1vdmVDbGFzcygnaGVhZGVyX19tZW51X2J1cmdlcl9hY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICQoJy5oZWFkZXJfX2J1cmdlci1tZW51X19saW5rJykucmVtb3ZlQ2xhc3MoJ2hlYWRlcl9fYnVyZ2VyLW1lbnVfX2xpbmtfYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTY3JvbGwgUGFnZSB0byB0aGUgVG9wXHJcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGVcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLmdvVG9Ub3AgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgICQoJ2JvZHksIGh0bWwnKS5hbmltYXRlKHtzY3JvbGxUb3A6IDB9LCA2MDApO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNob3dzIGJ1cmdlci1tZW51XHJcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGVcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLmJ1cmdlck1lbnUgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdoZWFkZXJfX2J1cmdlci1tZW51X19saW5rX2FjdGl2ZScpKSB7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdoZWFkZXJfX2J1cmdlci1tZW51X19saW5rX2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgJCgnLmhlYWRlcl9fbWVudScpLnJlbW92ZUNsYXNzKCdoZWFkZXJfX21lbnVfYnVyZ2VyX2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgJCgnaHRtbCcpLnJlbW92ZUNsYXNzKCdmaXhlZCcpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnaGVhZGVyX19idXJnZXItbWVudV9fbGlua19hY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICQoJy5oZWFkZXJfX21lbnUnKS5hZGRDbGFzcygnaGVhZGVyX19tZW51X2J1cmdlcl9hY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5hZGRDbGFzcygnZml4ZWQnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEluaXQgbW9kdWxlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgc2VsZi5pbml0ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIoKTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoISgnbW9kdWxlcycgaW4gJCkpIHtcclxuICAgICAgICAkLm1vZHVsZXMgPSB7fTtcclxuICAgIH1cclxuXHJcbiAgICAkLm1vZHVsZXMuaGVhZGVyID0gbmV3IEhlYWRlcigpO1xyXG59KSgpO1xyXG4iLCIoKCkgPT4ge1xyXG4gICAgaWYgKCdtb2R1bGVzJyBpbiAkICYmICdtYWluJyBpbiAkLm1vZHVsZXMpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IE1haW4gY2xhc3MuXHJcbiAgICAgKiBAY2xhc3NcclxuICAgICAqL1xyXG4gICAgY29uc3QgTWFpbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBzZWxmLndpbmRvdyA9ICQod2luZG93KTtcclxuICAgICAgICBzZWxmLmh0bWwgPSAkKCdodG1sJyk7XHJcbiAgICAgICAgc2VsZi5ib2R5ID0gJCgnYm9keScpO1xyXG4gICAgICAgIHNlbGYubW9kdWxlcyA9ICQubW9kdWxlcztcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSW5pdCBhbGwgbW9kdWxlcyBpbiAkLm1vZHVsZXNcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLmluaXRNb2R1bGVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IG1vZHVsZSBpbiBzZWxmLm1vZHVsZXMpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5tb2R1bGVzLmhhc093blByb3BlcnR5KG1vZHVsZSkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWxmLm1vZHVsZXNbbW9kdWxlXS5pbml0ICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUgIT09ICdtYWluJykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5tb2R1bGVzW21vZHVsZV0uaW5pdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEluaXQgbW9kdWxlXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgc2VsZi5pbml0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHNlbGYuaW5pdE1vZHVsZXMoKTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoISgnbW9kdWxlcycgaW4gJCkpIHtcclxuICAgICAgICAkLm1vZHVsZXMgPSB7fTtcclxuICAgIH1cclxuXHJcbiAgICAkLm1vZHVsZXMubWFpbiA9IG5ldyBNYWluKCk7XHJcbn0pKCk7XHJcbiIsIigoKSA9PiB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiAkICYmICdtYXAnIGluICQubW9kdWxlcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBNYXAgY2xhc3MuXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgY29uc3QgTWFwID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbnNlcnQgTWFwIHRvIHRoZSBwYWdlXG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmluc2VydE1hcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbGV0IHN0eWxlQXJyYXkgPSBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ3dhdGVyJyxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVyczogW3tjb2xvcjogJyMxODY5ZGEnfV1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6ICdsYW5kc2NhcGUnLFxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogJ2dlb21ldHJ5LmZpbGwnLFxuICAgICAgICAgICAgICAgICAgICBzdHlsZXJzOiBbe2NvbG9yOiAnI2ZmZmZmZid9XVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ2xhbmRzY2FwZS5tYW5fbWFkZScsXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRUeXBlOiAnYWxsJyxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVyczogW3tzYXR1cmF0aW9uOiAnLTcwJ31dXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGZlYXR1cmVUeXBlOiAnbGFuZHNjYXBlLm5hdHVyYWwnLFxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogJ2FsbCcsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlcnM6IFt7dmlzaWJpbGl0eTogJ29mZid9XVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ3BvaScsXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRUeXBlOiAnbGFiZWxzJyxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVyczogW3t2aXNpYmlsaXR5OiAnb2ZmJ31dXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGZlYXR1cmVUeXBlOiAncG9pLnBhcmsnLFxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogJ2FsbCcsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlcnM6IFt7Y29sb3I6ICcjRUVFRUVFJ31dXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGZlYXR1cmVUeXBlOiAncm9hZCcsXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRUeXBlOiAnYWxsJyxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVyczogW3tsaWdodG5lc3M6ICctNSd9XVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogJ3RyYW5zaXQnLFxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogJ2xhYmVscycsXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlcnM6IFt7dmlzaWJpbGl0eTogJ29mZid9XVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIC8qZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMqLyAvKm5vIGVycm9ycyB3aGVuIHRhc2sgZ3VscCBkZWZ1bHQgcnVuKi9cbiAgICAgICAgICAgIGxldCBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgICAgICAgICAgIGNlbnRlcjoge2xhdDogNTMuOTI5ODQ3LCBsbmc6IDI3LjU3NjQyMH0sXG4gICAgICAgICAgICAgICAgc3R5bGVzOiBzdHlsZUFycmF5LFxuICAgICAgICAgICAgICAgIGRpc2FibGVEZWZhdWx0VUk6IHRydWUsXG4gICAgICAgICAgICAgICAgem9vbTogMTQsXG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSgyNCwxMDUsMjE4LC4wNCknXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIC8qZXNsaW50LWVuYWJsZSBuby11bnVzZWQtdmFycyovXG5cbiAgICAgICAgICAgIGxldCBtYXJrZXJzID0gJCgnLm1hcCcpLmRhdGEoJ21hcmtlcnMnKTtcbiAgICAgICAgICAgIGxldCBpbWFnZSA9IHtcbiAgICAgICAgICAgICAgICB1cmw6ICcuLi9pbWFnZXMvdmlzLXBpbi1tYXAucG5nJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGxldCBtYXJrZXJzQXJyYXkgPSBbXTtcbiAgICAgICAgICAgIGxldCBpbmZvV2luZG93QXJyYXkgPSBbXTtcblxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXJrZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjoge2xhdDogbWFya2Vyc1tpXS5sYXQsIGxuZzogbWFya2Vyc1tpXS5sbmd9LFxuICAgICAgICAgICAgICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUCxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogaW1hZ2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zdCB0aXRsZSA9IGA8ZGl2IGNsYXNzPVwibWFwLWluZm9fX3RpdGxlXCI+JHttYXJrZXJzW2ldLnRpdGxlfTwvZGl2PmA7XG4gICAgICAgICAgICAgICAgY29uc3QgYWRkcmVzcyA9IGA8ZGl2IGNsYXNzPVwibWFwLWluZm9fX3RleHRcIj4ke21hcmtlcnNbaV0uYWRkcmVzc308L2Rpdj5gO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnRTdHJpbmcgPSB0aXRsZSArIGFkZHJlc3M7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5mb1dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KHtcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogY29udGVudFN0cmluZ1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgbWFya2Vyc0FycmF5LnB1c2gobWFya2VyKTtcbiAgICAgICAgICAgICAgICBpbmZvV2luZG93QXJyYXkucHVzaChpbmZvV2luZG93KTtcblxuICAgICAgICAgICAgICAgIG1hcmtlci5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXJrZXJzQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm9XaW5kb3dBcnJheVtpXS5jbG9zZShtYXAsIG1hcmtlcnNBcnJheVtpXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaW5mb1dpbmRvdy5vcGVuKG1hcCwgbWFya2VyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdCBtb2R1bGVcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuaW5pdCA9ICgpID0+IHtcbiAgICAgICAgICAgIHNlbGYuaW5zZXJ0TWFwKCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiAkKSkge1xuICAgICAgICAkLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICAkLm1vZHVsZXMubWFwID0gbmV3IE1hcCgpO1xufSkoKTtcbiIsIigoKSA9PiB7XHJcbiAgICBpZiAoJ21vZHVsZXMnIGluICQgJiYgJ21lbnUnIGluICQubW9kdWxlcykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgTWVudSBjbGFzcy5cclxuICAgICAqIEBjbGFzc1xyXG4gICAgICovXHJcbiAgICBjb25zdCBNZW51ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEFkZCBldmVudHMgbGlzdGVuZXJzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgc2VsZi5zZXR1cExpc3RlbmVyID0gKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLmhhc2gpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuc2hvd1NlY3Rpb24od2luZG93LmxvY2F0aW9uLmhhc2gsIGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBzZWxmLmNoZWNrU2VjdGlvbik7XHJcblxyXG4gICAgICAgICAgICAkKCcubWVudV9fbGluaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoISQoJy5oZWFkZXJfX21lbnUnKS5oYXNDbGFzcygnaGVhZGVyX19tZW51X2J1cmdlcl9hY3RpdmUnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2hvd1NlY3Rpb24oJCh0aGlzKS5hdHRyKCdocmVmJyksIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnNob3dTZWN0aW9uKCQodGhpcykuYXR0cignaHJlZicpLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkKCdodG1sJykucmVtb3ZlQ2xhc3MoJ2ZpeGVkJyk7XHJcbiAgICAgICAgICAgICAgICAkKCcuaGVhZGVyX19idXJnZXItbWVudV9fbGluaycpLnJlbW92ZUNsYXNzKCdoZWFkZXJfX2J1cmdlci1tZW51X19saW5rX2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgJCgnLmhlYWRlcl9fbWVudScpLnJlbW92ZUNsYXNzKCdoZWFkZXJfX21lbnVfYnVyZ2VyX2FjdGl2ZScpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBDaGVjayBTZWN0aW9uIChhZGQgaGFzaCB0byBVUkwpXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgc2VsZi5jaGVja1NlY3Rpb24gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJCgnc2VjdGlvbicpLmVhY2goZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0ICR0aGlzID0gJCh0aGlzKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJHRoaXMuZGF0YSgnc2VjdGlvbicpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGxldCB0b3BFZGdlID0gJHRoaXMub2Zmc2V0KCkudG9wIC0gMjUwO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBib3R0b21FZGdlID0gdG9wRWRnZSArICR0aGlzLmhlaWdodCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB3U2Nyb2xsID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodG9wRWRnZSA8IHdTY3JvbGwgJiYgYm90dG9tRWRnZSA+IHdTY3JvbGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRJZCA9ICR0aGlzLmRhdGEoJ3NlY3Rpb24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlcUxpbmsgPSAkKCcubWVudV9fbGluaycpLmZpbHRlcignW2hyZWY9XCIjJyArIGN1cnJlbnRJZCArICdcIl0nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcUxpbmsuY2xvc2VzdCgnLm1lbnVfX2l0ZW0nKS5hZGRDbGFzcygnbWVudV9faXRlbV9hY3RpdmUnKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKCdtZW51X19pdGVtX2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9IGN1cnJlbnRJZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy5kYXRhKCdzZWN0aW9uJykgPT09ICdtYWluJykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpdGVtcyA9ICQoJy5tZW51X19pdGVtJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucmVtb3ZlQ2xhc3MoJ21lbnVfX2l0ZW1fYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTaG93IFNlY3Rpb25cclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gc2VjdGlvblxyXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpc0FuaW1hdGVcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLnNob3dTZWN0aW9uID0gZnVuY3Rpb24oc2VjdGlvbiwgaXNBbmltYXRlKSB7XHJcbiAgICAgICAgICAgIGxldCBkaXJlY3Rpb24gPSBzZWN0aW9uLnJlcGxhY2UoLyMvLCAnJyk7XHJcbiAgICAgICAgICAgIGxldCByZXFTZWN0aW9uID0gJCgnc2VjdGlvbicpLmZpbHRlcignW2RhdGEtc2VjdGlvbj1cIicgKyBkaXJlY3Rpb24gKyAnXCJdJyk7XHJcbiAgICAgICAgICAgIGxldCByZXFTZWN0aW9uUG9zID0gcmVxU2VjdGlvbi5vZmZzZXQoKS50b3AtJCgnLmhlYWRlcicpLmhlaWdodCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzQW5pbWF0ZSkge1xyXG4gICAgICAgICAgICAgICAgJCgnYm9keSwgaHRtbCcpLmFuaW1hdGUoe3Njcm9sbFRvcDogcmVxU2VjdGlvblBvc30sIDYwMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkKCdib2R5LCBodG1sJykuc2Nyb2xsVG9wKHJlcVNlY3Rpb25Qb3MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogSW5pdCBtb2R1bGVcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLmluaXQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGlmICghKCdtb2R1bGVzJyBpbiAkKSkge1xyXG4gICAgICAgICQubW9kdWxlcyA9IHt9O1xyXG4gICAgfVxyXG5cclxuICAgICQubW9kdWxlcy5tZW51ID0gbmV3IE1lbnUoKTtcclxufSkoKTtcclxuIiwiKCgpID0+IHtcclxuICAgIGlmICgnbW9kdWxlcycgaW4gJCAmJiAnb3dsJyBpbiAkLm1vZHVsZXMpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgbmV3IE93bCBjbGFzcy5cclxuICAgICAqIEBjbGFzc1xyXG4gICAgICovXHJcbiAgICBjb25zdCBPd2wgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ291bnQgdGhlIG51bWJlciBvZiBpdGVtcyBpbiB0aGUgY2Fyb3VzZWxcclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gaXRlbXNcclxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY29udGFpbmVyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgc2VsZi5jb3VudEl0ZW1zID0gZnVuY3Rpb24oaXRlbXMsIGNvbnRhaW5lcikge1xyXG4gICAgICAgICAgICBsZXQgbmV3VGV4dCA9ICcgJyArIGl0ZW1zLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5kYXRhKCdpdGVtcycsIGl0ZW1zLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci50ZXh0KG5ld1RleHQpO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGlmICghKCdtb2R1bGVzJyBpbiAkKSkge1xyXG4gICAgICAgICQubW9kdWxlcyA9IHt9O1xyXG4gICAgfVxyXG5cclxuICAgICQubW9kdWxlcy5vd2wgPSBuZXcgT3dsKCk7XHJcbn0pKCk7XHJcbiIsIigoKSA9PiB7XG4gICAgaWYgKCdtb2R1bGVzJyBpbiAkICYmICdyZXZpZXdzJyBpbiAkLm1vZHVsZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgUmV2aWV3cyBjbGFzcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKi9cbiAgICBjb25zdCBSZXZpZXdzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcGVucyBmdWxsIHJldmlld1xuICAgICAgICAgKi9cbiAgICAgICAgc2VsZi5vcGVuRnVsbFJldmlldyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCgnLnJldmlld19faHJlZicpLmZhbmN5Ym94KHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnaW5saW5lJyxcbiAgICAgICAgICAgICAgICBtYXhXaWR0aDogNDYwLFxuICAgICAgICAgICAgICAgIHBhZGRpbmc6IDAsXG4gICAgICAgICAgICAgICAgY2xvc2VCdG46IGZhbHNlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBzZWxmLmluaXQgPSAoKSA9PiB7XG4gICAgICAgICAgICBzZWxmLm9wZW5GdWxsUmV2aWV3KCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGlmICghKCdtb2R1bGVzJyBpbiAkKSkge1xuICAgICAgICAkLm1vZHVsZXMgPSB7fTtcbiAgICB9XG5cbiAgICAkLm1vZHVsZXMucmV2aWV3cyA9IG5ldyBSZXZpZXdzKCk7XG59KSgpO1xuIiwiKCgpID0+IHtcclxuICAgIGlmICgnbW9kdWxlcycgaW4gJCAmJiAnc3RlcHMnIGluICQubW9kdWxlcykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgU3RlcHMgY2xhc3MuXHJcbiAgICAgKiBAY2xhc3NcclxuICAgICAqL1xyXG4gICAgY29uc3QgU3RlcHMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQWRkIGV2ZW50cyBsaXN0ZW5lcnNcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLnNldHVwTGlzdGVuZXIgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICQod2luZG93KS5vbigncmVzaXplJywgc2VsZi5hbmltYXRlU3RlcHMpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIE1ha2VzIGVxdWFsIGhpZ2h0IG9mIHN0ZXBzLWl0ZW1zXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgc2VsZi5lcXVhbEhpZ2h0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGxldCBpdGVtID0gJCgnLnN0ZXBzX19pdGVtJyk7XHJcblxyXG4gICAgICAgICAgICBpdGVtLm1hdGNoSGVpZ2h0KCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQW5pbWF0ZSBTdGVwcy1UYWJsZXRcclxuICAgICAgICAgKi9cclxuICAgICAgICBzZWxmLmFuaW1hdGVTdGVwcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBsZXQgb3dsID0gJCgnLnN0ZXBzX19saXN0Jyk7XHJcbiAgICAgICAgICAgIGxldCBuYXYgPSBvd2wubmV4dCgnLm93bC1uYXZpZ2F0aW9uJyk7XHJcbiAgICAgICAgICAgIGxldCBhbGxQYWdlcyA9IG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2FsbC1wYWdlcycpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCQod2luZG93KS53aWR0aCgpIDw9ICcxMDIzJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFvd2wuaGFzQ2xhc3MoJ293bC1jYXJvdXNlbCcpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3dsLmFkZENsYXNzKCdvd2wtY2Fyb3VzZWwnKS5hZGRDbGFzcygnLm93bC10aGVtZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIG93bC5vbignaW5pdGlhbGl6ZWQub3dsLmNhcm91c2VsJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgaXRlbSA9ICQoJy5zdGVwc19faXRlbScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgYWN0aXZlSXRlbSA9IG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2FjdGl2ZS1wYWdlJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmFkZENsYXNzKCdzdGVwc19faXRlbV9jYXJvdXNlbCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLm1hdGNoSGVpZ2h0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZUl0ZW0udGV4dCgnMSAnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmF2LmFkZENsYXNzKCdvd2wtbmF2aWdhdGlvbl9hY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fbGlua19wcmV2JykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGxQYWdlcy50ZXh0KGUuaXRlbS5jb3VudCAtIChNYXRoLmZsb29yKG93bC53aWR0aCgpL2l0ZW0uaW5uZXJXaWR0aCgpKS0xKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG93bC5vd2xDYXJvdXNlbCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3A6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0b1dpZHRoOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZUJ5OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzbWFydFNwZWVkOiAzMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlRHJhZzogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm86IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNpdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDY0MToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiA0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9XaWR0aDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJnaW46IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVCeTogMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG93bC5vbignY2hhbmdlZC5vd2wuY2Fyb3VzZWwnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFjdGl2ZUl0ZW0gPSBvd2wuZmluZCgnLm93bC1kb3QuYWN0aXZlJykuaW5kZXgoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5ld1RleHQgPSBhY3RpdmVJdGVtICsgMSArICcgJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNvbnRhaW5lciA9IG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2FjdGl2ZS1wYWdlJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXIudGV4dChuZXdUZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZUl0ZW0gPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2xpbmtfcHJldicpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fbGlua19wcmV2JykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChhY3RpdmVJdGVtKzEpLnRvU3RyaW5nKCkgPT09IG5hdi5maW5kKCcub3dsLW5hdmlnYXRpb25fX2FsbC1wYWdlcycpLnRleHQoKS5yZXBsYWNlKFwiIFwiLCBcIlwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2LmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fbGlua19uZXh0JykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYXYuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19saW5rX25leHQnKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBuYXYuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19saW5rJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCAkdGhpcyA9ICQodGhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMuaGFzQ2xhc3MoJ293bC1uYXZpZ2F0aW9uX19saW5rX3ByZXYnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3dsLnRyaWdnZXIoJ3ByZXYub3dsLmNhcm91c2VsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvd2wudHJpZ2dlcignbmV4dC5vd2wuY2Fyb3VzZWwnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBhbGxQYWdlcy50ZXh0KCQoJy5zdGVwc19fbGlzdCcpLm5leHQoJy5vd2wtbmF2aWdhdGlvbicpLmZpbmQoJy5vd2wtbmF2aWdhdGlvbl9fYWxsLXBhZ2VzJykuZGF0YSgnaXRlbXMnKSAtIChNYXRoLmZsb29yKG93bC53aWR0aCgpLyQoJy5zdGVwc19faXRlbScpLmlubmVyV2lkdGgoKSktMSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKG93bC5oYXNDbGFzcygnb3dsLWNhcm91c2VsJykpIHtcclxuICAgICAgICAgICAgICAgICAgICBvd2wub2ZmKCdjaGFuZ2VkLm93bC5jYXJvdXNlbCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIG93bC5yZW1vdmVDbGFzcygnb3dsLWNhcm91c2VsJykucmVtb3ZlQ2xhc3MoJy5vd2wtdGhlbWUnKTtcclxuICAgICAgICAgICAgICAgICAgICBuYXYuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19saW5rJykub2ZmKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgb3dsLm5leHQoJy5vd2wtbmF2aWdhdGlvbicpLnJlbW92ZUNsYXNzKCdvd2wtbmF2aWdhdGlvbl9hY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICBvd2wudHJpZ2dlcignZGVzdHJveS5vd2wuY2Fyb3VzZWwnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcuc3RlcHNfX2l0ZW0nKS5yZW1vdmVDbGFzcygnc3RlcHNfX2l0ZW1fY2Fyb3VzZWwnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNlbGYuaW5pdCA9ICgpID0+IHtcclxuICAgICAgICAgICAgc2VsZi5lcXVhbEhpZ2h0KCk7XHJcbiAgICAgICAgICAgICQubW9kdWxlcy5vd2wuY291bnRJdGVtcygkKCcuc3RlcHNfX2l0ZW0nKSwgJCgnLnN0ZXBzX19saXN0JykubmV4dCgnLm93bC1uYXZpZ2F0aW9uJykuZmluZCgnLm93bC1uYXZpZ2F0aW9uX19hbGwtcGFnZXMnKSk7XHJcbiAgICAgICAgICAgIHNlbGYuYW5pbWF0ZVN0ZXBzKCk7XHJcbiAgICAgICAgICAgIHNlbGYuc2V0dXBMaXN0ZW5lcigpO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGlmICghKCdtb2R1bGVzJyBpbiAkKSkge1xyXG4gICAgICAgICQubW9kdWxlcyA9IHt9O1xyXG4gICAgfVxyXG5cclxuICAgICQubW9kdWxlcy5zdGVwcyA9IG5ldyBTdGVwcygpO1xyXG59KSgpO1xyXG4iXX0=
